(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{zl81:function(e,t,i){"use strict";i.r(t),i.d(t,"TicketListModule",(function(){return yi}));var n=i("sEIs"),o=i("nIj0"),s=i("2kYt"),c=i("vobO"),r=i("jY47"),a=i("EM62"),l=(i("ZTXN"),i("C05f"),i("HM3f"),i("g6G6"),i("qvOF")),d=i("D57K"),b=(i("7ucf"),i("jIqt"),i("kuMc"),i("TLy2")),h=i("sg/T"),u=(i("fAiE"),i("HYj3")),p=i("cZZj"),g=(i("ZXq0"),i("UPS/"),i("D69K")),m=i("kZKz"),f=i("6hlU"),T=i("1spV"),k=i("Sv/w"),_=i("Ux30");let S=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.b,k.e,m.a,_.c]]}),e})();var O=i("JbzU");let C=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.b,_.c,o.i,p.b,u.f,O.b,m.a,S,f.c,g.b,T.b,l.f,h.a]]}),e})();var j=i("XS/p");let z=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.b,m.a]]}),e})();var y=i("mybp"),v=i("duTG"),w=i("PlhU"),D=i("MaY1"),I=i("qPk4"),x=i("fWDI"),A=i("B0q8"),F=i("1EA0"),V=i("d+64"),N=i("U6NZ");let M=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.b,o.i,o.q,v.c,y.e,O.b,D.c,N.a,V.a]]}),e})();var R=i("5VY1"),B=i("FP8e");let U=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.b,o.q,v.c,y.e,O.b]]}),e})(),L=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.b,o.q,v.c,y.e,O.b]]}),e})(),E=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.b,c.d,o.i,o.q,U,L,r.c,F.b,z,y.e,D.c,A.b,C,x.b,v.c,O.b,N.a,B.a,w.d,R.a]]}),e})();var G=i("Tu4v"),K=i("8SNO"),q=i("BlE5"),H=i("pV1J"),P=i("qBiZ"),Y=i("K8Gv");function W(e,t){return!!Object(Y.i)(e)||!Object(Y.i)(e.get(t))&&e.get(t)._pendingDirty}function $(e,t,i){t=t||!1,i=Object.assign({},i);const n=[];Object(Y.l)(e.email)||n.push(""+e.email);const o=i.subject||J(e);return null!==o&&n.push(o),Object(Y.l)(e.tax_code)||n.push("- M\xe3 s\u1ed1 thu\u1ebf / M\xe3 \u0111\u01a1n v\u1ecb: "+e.tax_code),Object(Y.l)(e.customer_name)||n.push("- T\xean kh\xe1ch h\xe0ng: "+e.customer_name),Object(Y.l)(e.email)||n.push("- Email: "+e.email),n.push(t?X(e).join("\n"):i.body||e.body||X(e).join("\n")),n.push("--------------------------------------------"),n.push(t?Q(e).join("\n"):i.note||e.note||Q(e).join("\n")),n.join("\n")}function X(e,t){const i=[];let n=e.edit_ticket||!1;if(W(t,"phone")&&!Object(Y.l)(e.phone)&&(i.push("- S\u1ed1 \u0111i\u1ec7n tho\u1ea1i li\xean h\u1ec7: "+e.phone),n=!0),W(t,"content_required")&&!Object(Y.l)(e.content_required)){let t=e.content_required,o=Object(Y.l)(e.soft_name)?"":e.soft_name+" - ",s=Object(Y.i)(e.support_help)||Object(Y.l)(e.support_help.support)?"":" - "+e.support_help.support;i.push(`- N\u1ed9i dung c\u1ea7n h\u1ed7 tr\u1ee3: ${o}${t}${s}`),n=!0}return W(t,"full_name")&&!Object(Y.l)(e.full_name)&&(i.push("- Nh\xe2n vi\xean g\u1eedi th\xf4ng tin: "+e.full_name),n=!0),W(t,"reception_time")&&!Object(Y.l)(e.reception_time)&&(i.push("- Th\u1eddi gian ti\u1ebfp nh\u1eadn: "+e.reception_time),n=!0),e.edit_ticket=n,i}function Q(e,t){const i=[];let n=e.edit_ticket||!1;return W(t,"full_name")&&!Object(Y.l)(e.full_name)&&(i.push("- H\u1ecd t\xean: "+e.full_name),n=!0),W(t,"support_help")&&!Object(Y.i)(e.support_help)&&(i.push("- H\xecnh th\u1ee9c h\u1ed7 tr\u1ee3: "+e.support_help.value),n=!0),W(t,"group_help")&&!Object(Y.i)(e.group_help)&&(i.push("- Nh\xf3m h\u1ed7 tr\u1ee3: "+e.group_help.title),n=!0),W(t,"content_help")&&!Object(Y.l)(e.content_help)&&(i.push(`- N\u1ed9i dung \u0111\xe3 h\u1ed7 tr\u1ee3: ${e.content_help} `),n=!0),W(t,"complete_time")&&!Object(Y.l)(e.complete_time)&&(i.push("- Th\u1eddi gian ho\xe0n t\u1ea5t: "+e.complete_time),n=!0),e.edit_ticket=n,i}function J(e){if(!Object(Y.l)(e.tax_code)&&!Object(Y.g)(e.chanels))return`[HT-${e.chanels[0].code}]-${e.user_code}-${e.tax_code}-${e.ticket_on}`}var Z=i("5uDM"),ee=i("BwBJ"),te=i("J+dc"),ie=i("8j5Y"),ne=i("ROBh"),oe=i("3p4X"),se=i("IdLP"),ce=i("6Oco"),re=i("lSkQ"),ae=i("2mfu");let le=(()=>{class e{constructor(e){this.srv=e}get userCtrl(){return this.srv.inj.get(G.a)}getUrlApi(e){let t=this.userCtrl.read().id;return this.srv.cfig().read().fixUrl(`odrest/${t}/${e}`)}odooCfig(){return this.srv.cfig().read().api_ticket}odooUser(){return this.userCtrl.read().od_user}get client(){return this.srv.client()}sendGet(e,t,i){return i=Object.assign({alert:!0},i,{params:t}),this.client.send("GET",e,i)}sendPost(e,t,i){return i=Object.assign({alert:!0},i,{body:t}),this.client.send("POST",e,i)}fixPage(e){return Object.assign({size:80},e)}}return e.\u0275fac=function(t){return new(t||e)(a.Xb(ae.a))},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),de=(()=>{class e extends le{nameSearch(e){return this.sendGet(this.getUrlApi("find-user/"+e))}}return e.\u0275fac=function(t){return be(t||e)},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const be=a.Vb(de);let he=(()=>{class e extends le{searchRead(e,t){let i=this.getUrlApi("get-partner"),n=Object.assign(Object.assign({},e),this.fixPage(t));return this.sendGet(i,n)}getDetail(e){return this.sendGet(this.getUrlApi("get-partner-byid/"+e))}createOne(e){let t=this.getUrlApi("create-partner");return this.sendPost(t,e,{alert:!1})}}return e.\u0275fac=function(t){return ue(t||e)},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ue=a.Vb(he);let pe=(()=>{class e extends le{searchRead(e,t){let i=this.getUrlApi("get-ticket"),n=Object.assign(Object.assign({},e),this.fixPage(t));return this.sendGet(i,n)}getTicketOdooById(e){return this.sendGet(this.getUrlApi("get-ticket-web?id="+e))}getTicketOdooByLink(e){return this.sendGet(this.getUrlApi("get-ticket-web?link="+e))}getDetail(e){return this.sendGet(this.getUrlApi("get-ticket-byid/"+e))}newTicket(e){return this.createAll(e,"create_ticket")}updateTicket(e){return this.createAll(e,"update_ticket")}addNote(e){return this.createAll(e,"add_note")}getNoteDetail(e){return Object(ne.a)({id:e})}closeTicket(e){return this.createAll(e,"close_ticket")}createAll(e,t,i){let n=this.getUrlApi(`send/${t}/${e}`);return this.sendPost(n,i,{alert:!1})}}return e.\u0275fac=function(t){return ge(t||e)},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ge=a.Vb(pe);let me=(()=>{class e extends le{searchRead(e,t){return this.sendGet(this.getUrlApi("get-team"))}nameSearch(e){return Object(ce.b)()}}return e.\u0275fac=function(t){return fe(t||e)},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const fe=a.Vb(me);let Te=(()=>{class e extends le{searchRead(e,t){return this.sendGet(this.getUrlApi("get-topic"))}}return e.\u0275fac=function(t){return ke(t||e)},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const ke=a.Vb(Te);let _e=(()=>{class e extends le{getCategories(e,t){return this.sendGet(this.getUrlApi("get-category"))}getStages(){return this.sendGet(this.getUrlApi("get-stage"))}loadAllInOne(e){return this.sendGet(this.getUrlApi("get-all/"+e)).pipe(Object(ie.a)(e=>{this.srv.shared().catalogs=Object.assign({},this.srv.shared().catalogs,e)}))}}return e.\u0275fac=function(t){return Se(t||e)},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Se=a.Vb(_e);let Oe=(()=>{class e{constructor(e,t,i,n,o,s){this.user=e,this.partner=t,this.ticket=i,this.team=n,this.topic=o,this.cate=s}}return e.\u0275fac=function(t){return new(t||e)(a.Xb(de),a.Xb(he),a.Xb(pe),a.Xb(me),a.Xb(Te),a.Xb(_e))},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Ce=i("77ZH"),je=i("ZTwM");function ze(e,t){1&e&&(a.Tb(0,"div",3),a.Tb(1,"label",32),a.Dc(2,"T\xean c\xf4ng ty"),a.Sb(),a.Tb(3,"nz-input-group",33),a.Ob(4,"input",34),a.Ob(5,"input",35),a.Sb(),a.Sb())}function ye(e,t){1&e&&(a.Tb(0,"div",3),a.Tb(1,"label",36),a.Dc(2,"Ng\u01b0\u1eddi li\xean h\u1ec7 (C\xe1 nh\xe2n *)"),a.Sb(),a.Tb(3,"nz-input-group",33),a.Ob(4,"input",37),a.Ob(5,"input",38),a.Sb(),a.Sb())}function ve(e,t){1&e&&(a.Tb(0,"div",3),a.Tb(1,"label",39),a.Dc(2,"\u0110\u1ecba ch\u1ec9"),a.Sb(),a.Ob(3,"input",40),a.Sb())}function we(e,t){1&e&&(a.Tb(0,"div",3),a.Tb(1,"label",41),a.Dc(2,"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i (C\xe1 nh\xe2n)"),a.Sb(),a.Ob(3,"input",42),a.Sb())}function De(e,t){1&e&&a.Ob(0,"i",43)}function Ie(e,t){1&e&&a.Ob(0,"i",44)}function xe(e,t){if(1&e&&(a.Tb(0,"button",45),a.Dc(1,"T\xecm theo API"),a.Sb()),2&e){const e=a.dc();a.jc("disabled",e.disabled)}}function Ae(e,t){1&e&&a.Ob(0,"i",43)}function Fe(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",46),a.ac("click",(function(){return a.sc(e),a.dc().onCreateContact("person")})),a.Bc(1,Ae,1,0,"i",17),a.Tb(2,"span"),a.Dc(3,"+ C\xe1 nh\xe2n"),a.Sb(),a.Sb()}if(2&e){const e=a.dc();a.jc("disabled",e.disabled_person),a.zb(1),a.jc("ngIf",e.isAsyncCreate)}}function Ve(e,t){1&e&&a.Ob(0,"i",43)}function Ne(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",46),a.ac("click",(function(){return a.sc(e),a.dc().onCreateContact("company")})),a.Bc(1,Ve,1,0,"i",17),a.Tb(2,"span"),a.Dc(3,"+ C\xf4ng ty"),a.Sb(),a.Sb()}if(2&e){const e=a.dc();a.jc("disabled",e.disabled_company),a.zb(1),a.jc("ngIf",e.isAsyncCreate)}}const Me=function(){return{standalone:!0}};function Re(e,t){if(1&e){const e=a.Ub();a.Tb(0,"nz-input-group"),a.Tb(1,"label",47),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().autoUpdate=t})),a.Tb(2,"span"),a.Dc(3,"C\u1eadp nh\u1eadt khi ch\u1ecdn"),a.Sb(),a.Sb(),a.Tb(4,"button",48),a.ac("click",(function(){return a.sc(e),a.dc().onBtnSelectRow()})),a.Dc(5,"Ch\u1ecdn"),a.Sb(),a.Sb()}if(2&e){const e=a.dc();a.zb(1),a.jc("ngModel",e.autoUpdate)("ngModelOptions",a.lc(2,Me))}}let Be=(()=>{class e{constructor(e,t,i,n,o,s,c){this.cdRef=e,this.od=t,this.fb=i,this.modalRef=n,this.cfig=o,this.userCtrl=s,this.shared=c,this.totalRow=void 0,this.searchLimit=100,this.isSearch=!1,this.chkCreate=!1,this.chkUpForm=!1,this.isAsyncCreate=!1,this.autoUpdate=!0,this.searchLog="",this.resultColumns=[],this.resultData=[],this.agRowClick=void 0,this.gridApi=void 0,this.agOption={domLayout:"normal",defaultColDef:{editable:!0,enableValue:!0,enableRowGroup:!0,enablePivot:!1,sortable:!1,resizable:!0,filter:!1},onRowClicked:e=>this.onAgRowClick(e)},this.fieldSearch=[],this.gridColumns=[],this.valueSearch={},this.searchWhere=[{label:"MST",value:"vat",checked:!0},{label:"E-mail",value:"email",checked:!0}]}ngOnInit(){this.initTaoForm(),this.createGridCols(),this.onSearch()}ngAfterViewInit(){this.gridApi=this.agGrid2.ngx.api,this.gridApi.getColumnDef("vat").cellStyle={color:"red","font-weight":"bold"},Ce.a.getColDef(this.gridApi,"open_link",e=>{e.cellRenderer=e=>`<a href="${this.getUrlView(e)}" target="_blank" class="open_link">Open</i></a>`})}getUrlView(e){let t=this.userCtrl.read().od_config.view_partner||"http://conyeu.dev";return Y.f.replaceQuery(t,{partnerId:e.data.id})}initTaoForm(){this.fieldSearch=[{key:"vat",label:"MST",operator:null},{key:"email",label:"Email",operator:null},{key:"comp_name",label:"T\xean c\xf4ng ty",operator:null},{key:"comp_id",label:"C\xf4ng ty ID",operator:null},{key:"phone",label:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i",operator:null},{key:"street",label:"\u0110\u1ecba ch\u1ec9",operator:null},{key:"customer_name",label:"Ng\u01b0\u1eddi li\xean h\u1ec7",operator:null},{key:"customer_id",label:"",operator:null}],this.searchFrm=this.fb.group({}),this.fieldSearch.forEach(e=>{let t=this.fb.control(this.valueSearch[e.key]||e.value);this.searchFrm.addControl(e.key,t)})}createGridCols(){this.resultColumns=[{headerName:"",field:"checked",colId:"checked",width:40,checkboxSelection:!0,headerCheckboxSelection:!0},{headerName:"Link",field:"open_link",colId:"open_link",width:75},{headerName:"M\xe3 s\u1ed1 thu\u1ebf",field:"vat",colId:"vat",width:150},{headerName:"T\xean hi\u1ec3n th\u1ecb",field:"display_name",colId:"display_name",width:400},{headerName:"E-mail",field:"email",colId:"email",width:230},{headerName:"S\u1ed1 \u0111i\u1ec7n tho\u1ea1i",field:"mobile",colId:"mobile",width:129},{headerName:"Ng\u01b0\u1eddi li\xean h\u1ec7",field:"name",colId:"name",width:168},{headerName:"T\xean c\xf4ng ty",field:"comp_name",colId:"comp_name",width:260}]}get isExistData(){return void 0!==this.gridApi&&this.gridApi.getSelectedNodes().length>0}get disabled(){return this.isSearch||this.isAsyncCreate}get disabled_person(){return this.disabled||!Object(Y.l)(this.getValueFrm().customer_id)}get disabled_company(){return this.disabled||!Object(Y.l)(this.getValueFrm().comp_id)}fieldTrackBy(e,t){return t?t.key:e}setValueFrm(e,t,i){if(i=i||[e],this.agRowClick=this.agRowClick||{},Object(Y.l)(t)){let e=i.map(e=>this.agRowClick[e]).filter(e=>!Object(Y.l)(e));t=e.length>0?e[0]:void 0}this.searchFrm.get(e).setValue(t)}getValueFrm(){return this.searchFrm.getRawValue()}onCloseRef(){this.modalRef.destroy()}onResetForm(){this.searchFrm.reset(this.valueSearch),this.chkUpForm=!1}formToObj(e){if(!this.searchFrm.invalid){let t=this.searchFrm.value;return 0===(e=(e=e||Object.keys(t)).filter(e=>!Object(Y.l)(t[e]))).length?void 0:e.map(e=>({[e]:t[e].trim()})).reduce((e,t)=>Object.assign(Object.assign({},e),t),{})}}onAgRowClick(e){this.agRowClick=e.data,Object(Y.i)(this.agRowClick)||(this.setValueFrm("vat"),this.setValueFrm("comp_name",null,["display_name","comp_name"]),this.setValueFrm("comp_id"),this.setValueFrm("street"),this.chkUpForm&&(this.setValueFrm("customer_id",null),this.setValueFrm("customer_name",null),this.setValueFrm("email",null),this.setValueFrm("phone",null)),!this.agRowClick.is_company&&this.chkUpForm&&(this.setValueFrm("customer_id",null,["id"]),this.setValueFrm("email"),this.setValueFrm("customer_name",null,["name"]),this.setValueFrm("phone")))}onClickUp(){this.chkUpForm||this.onResetForm()}onBtnSelectRow(){let e=this.gridApi.getSelectedRows();if(0===e.length)return void this.shared.alert.warning("<b>Vui l\xf2ng ch\u1ecdn 1 d\xf2ng.</b>");let t=e[0];Object.keys(t).forEach(e=>t[e]=t[e]?t[e]:void 0),this.modalRef.destroy({item:t,autoUpdate:this.autoUpdate})}onSearch(e){e=e||this.searchWhere.filter(e=>e.checked).map(e=>e.value);let t=this.formToObj(e);void 0!==t?(this.totalRow=void 0,this.isSearch=!0,console.log("Tim kiem thong tin: "+JSON.stringify(t)),this.od.partner.searchRead(t).subscribe(e=>{this.isSearch=!1,this.resultData=e,this.cdRef.detectChanges(),this.shared.alert.success(`T\xecm \u0111\u01b0\u1ee3c: <b>${e.length} k\u1ebft qu\u1ea3.</b>`)},e=>{this.isSearch=!1,this.cdRef.detectChanges()})):this.shared.alert.warning("<b>Vui l\xf2ng nh\u1eadp th\xf4ng tin t\xecm ki\u1ebfm.</b>")}onCreateContact(e){if(!["person","company"].includes(e))return;this.isAsyncCreate=!0;let t=this.getValueFrm(),i={phone:t.phone,mobile:t.phone,email:t.email,company_type:e};if("person"===e){if(Object(Y.l)(t.comp_id))return this.shared.alert.warning("<b>Vui l\xf2ng ch\u1ecdn c\xf4ng ty.</b>"),void(this.isAsyncCreate=!1);i=Object.assign(i,{name:t.customer_name||t.email,parent_id:t.comp_id})}else i=Object.assign(i,{name:t.comp_name||t.email,vat:t.vat,street:t.street,parent_id:!1});let n="company"==e?"C\xf4ng ty":"C\xe1 nh\xe2n";this.od.partner.createOne(i).subscribe(e=>{this.isAsyncCreate=!1,this.gridApi.setRowData([e]),this.cdRef.detectChanges(),this.shared.alert.success(`[${e.id}] T\u1ea1o <b>${n}</b> th\xe0nh c\xf4ng`)},e=>{this.isAsyncCreate=!1,this.cdRef.detectChanges(),this.shared.alert.error(`X\u1ea3y ra l\u1ed7i t\u1ea1o <b>${n}</b> > ${e.message} !`)})}}return e.\u0275fac=function(t){return new(t||e)(a.Nb(a.h),a.Nb(Oe),a.Nb(o.e),a.Nb(N.b),a.Nb(P.a),a.Nb(G.a),a.Nb(K.a))},e.\u0275cmp=a.Hb({type:e,selectors:[["cy-search-partner"]],viewQuery:function(e,t){var i;1&e&&a.Hc(re.a,!0),2&e&&a.qc(i=a.bc())&&(t.agGrid2=i.first)},inputs:{fieldSearch:"fieldSearch",gridColumns:"gridColumns",valueSearch:"valueSearch"},decls:46,vars:29,consts:[[1,"partner-search-wrapper"],[1,"row-form","form-body","pd-lr-5",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-6","form-group"],["for","vat"],["nz-input","","id","vat","formControlName","vat",1,"form-control","border","border-success"],["for","email"],["nz-input","","id","email","formControlName","email",1,"form-control","border","border-success"],["class","col-6 form-group",4,"ngIf"],[1,"row","mt-2"],[1,"col-12","d-flex","align-item-center"],["nz-label","",1,"text-info"],[1,"ml-2","w-none",3,"ngModel","ngModelOptions","ngModelChange"],[1,"row","tool"],[1,"col-12","d-flex","align-items-center"],["nz-button","","nzDanger","","type","button",3,"disabled","click"],["nz-button","","nzType","primary",3,"disabled"],["class","fal fa-sync-alt fa-spin",4,"ngIf"],["class","fas fa-cog",4,"ngIf"],["nz-button","","type","button",3,"disabled",4,"ngIf"],["nz-button","","type","button",3,"disabled","click",4,"ngIf"],["nz-checkbox","",3,"ngModel","ngModelOptions","disabled","ngModelChange","click"],["nz-checkbox","",3,"ngModel","ngModelOptions","disabled","ngModelChange"],[1,"row","row-log"],[1,"col-12",3,"innerHtml"],[1,"row","row-data"],[1,"col-12"],[3,"columns","rows","options","agHeight"],[1,"row","row-footer"],[1,"col-12","col-right"],[4,"ngIf"],["nz-button","","nzDanger","",3,"click"],["for","comp_name"],[1,"d-flex"],["nz-input","","id","comp_name","formControlName","comp_name",1,"form-control"],["nz-input","","id","comp_id","formControlName","comp_id",1,"form-control","ml-1","w-5","border","border-danger","font-weight-bold"],["for","customer_name"],["nz-input","","id","customer_name","formControlName","customer_name",1,"form-control"],["nz-input","","id","customer_id","formControlName","customer_id",1,"form-control","ml-1","w-5","border","border-danger","font-weight-bold"],["for","street"],["nz-input","","id","street","formControlName","street",1,"form-control"],["for","phone"],["nz-input","","id","phone","formControlName","phone",1,"form-control"],[1,"fal","fa-sync-alt","fa-spin"],[1,"fas","fa-cog"],["nz-button","","type","button",3,"disabled"],["nz-button","","type","button",3,"disabled","click"],["nz-checkbox","",3,"ngModel","ngModelOptions","ngModelChange"],["nz-button","","nzType","primary",3,"click"]],template:function(e,t){1&e&&(a.Tb(0,"div",0),a.Tb(1,"form",1),a.ac("ngSubmit",(function(){return t.onSearch()})),a.Tb(2,"div",2),a.Tb(3,"div",3),a.Tb(4,"label",4),a.Dc(5,"M\xe3 s\u1ed1 thu\u1ebf"),a.Sb(),a.Ob(6,"input",5),a.Sb(),a.Tb(7,"div",3),a.Tb(8,"label",6),a.Dc(9,"Email (C\xe1 nh\xe2n *)"),a.Sb(),a.Ob(10,"input",7),a.Sb(),a.Bc(11,ze,6,0,"div",8),a.Bc(12,ye,6,0,"div",8),a.Bc(13,ve,4,0,"div",8),a.Bc(14,we,4,0,"div",8),a.Sb(),a.Tb(15,"div",9),a.Tb(16,"div",10),a.Tb(17,"label",11),a.Dc(18,"T\xecm theo: "),a.Sb(),a.Tb(19,"nz-checkbox-group",12),a.ac("ngModelChange",(function(e){return t.searchWhere=e})),a.Sb(),a.Sb(),a.Sb(),a.Tb(20,"div",13),a.Tb(21,"div",14),a.Tb(22,"button",15),a.ac("click",(function(){return t.onResetForm()})),a.Dc(23,"L\u1ea5y t\u1eeb Form"),a.Sb(),a.Tb(24,"button",16),a.Bc(25,De,1,0,"i",17),a.Bc(26,Ie,1,0,"i",18),a.Tb(27,"span"),a.Dc(28,"T\xecm theo TS24"),a.Sb(),a.Sb(),a.Bc(29,xe,2,1,"button",19),a.Bc(30,Fe,4,2,"button",20),a.Bc(31,Ne,4,2,"button",20),a.Tb(32,"label",21),a.ac("ngModelChange",(function(e){return t.chkUpForm=e}))("click",(function(){return t.onClickUp()})),a.Dc(33,"Up+"),a.Sb(),a.Tb(34,"label",22),a.ac("ngModelChange",(function(e){return t.chkCreate=e})),a.Dc(35,"T\u1ea1o..."),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Tb(36,"div",23),a.Ob(37,"div",24),a.Sb(),a.Tb(38,"div",25),a.Tb(39,"div",26),a.Ob(40,"cy-ag-table",27),a.Sb(),a.Sb(),a.Tb(41,"div",28),a.Tb(42,"div",29),a.Bc(43,Re,6,3,"nz-input-group",30),a.Tb(44,"button",31),a.ac("click",(function(){return t.onCloseRef()})),a.Dc(45,"\u0110\xf3ng"),a.Sb(),a.Sb(),a.Sb(),a.Sb()),2&e&&(a.zb(1),a.jc("formGroup",t.searchFrm),a.zb(10),a.jc("ngIf",t.chkCreate),a.zb(1),a.jc("ngIf",t.chkCreate),a.zb(1),a.jc("ngIf",t.chkCreate),a.zb(1),a.jc("ngIf",t.chkCreate),a.zb(5),a.jc("ngModel",t.searchWhere)("ngModelOptions",a.lc(26,Me)),a.zb(3),a.jc("disabled",t.disabled),a.zb(2),a.jc("disabled",t.disabled),a.zb(1),a.jc("ngIf",t.isSearch),a.zb(1),a.jc("ngIf",!t.isSearch),a.zb(3),a.jc("ngIf",!1),a.zb(1),a.jc("ngIf",t.chkCreate),a.zb(1),a.jc("ngIf",t.chkCreate),a.zb(1),a.jc("ngModel",t.chkUpForm)("ngModelOptions",a.lc(27,Me))("disabled",t.disabled),a.zb(2),a.jc("ngModel",t.chkCreate)("ngModelOptions",a.lc(28,Me))("disabled",t.disabled),a.zb(3),a.jc("innerHtml",t.searchLog,a.tc),a.zb(3),a.jc("columns",t.resultColumns)("rows",t.resultData)("options",t.agOption)("agHeight","200px"),a.zb(3),a.jc("ngIf",t.isExistData))},directives:[o.t,o.m,o.h,y.b,o.d,o.l,o.g,s.n,D.b,o.o,v.a,je.a,T.a,D.a,re.a,y.c],styles:['[class*=" row-"]{margin-bottom:10px}.form-body{padding:5px;border-radius:2px;border:1px solid #ebedf0}.form-body .row .ant-input:not(textarea){height:27px;border-radius:0}.form-body .row.tool{margin-top:5px}.form-body .row.tool .search-limit{width:50px;margin-right:10px}.row-data .ag-body-viewport{min-height:50px;max-height:200px}.row-footer{margin:5px -10px 0;padding:10px 6px 0 16px;text-align:right;border-top:2px solid #e8e8e8;border-radius:0 0 4px 4px}.row-footer .col-left1{text-align:left;padding-left:0;margin-left:-4px}.row-footer .col-left1 .total{font-weight:700;margin-left:5px;color:var(--danger)}.row-footer .col-right{padding-right:5px}.row-footer .col-right .ant-btn:last-child{margin-right:0}.row-footer .col-right .ant-input-group{display:inline-flex;align-items:center;width:unset!important;margin-right:.5rem!important}a.open_link{text-decoration:underline;color:var(--blue)!important}'],encapsulation:2,changeDetection:0}),e})();var Ue=i("XpVc");function Le(e,t){1&e&&a.Ob(0,"i",11),2&e&&a.jc("nzType","sync")("nzSpin",!0)}function Ee(e,t){1&e&&a.Ob(0,"i",12)}let Ge=(()=>{class e{constructor(e,t,i,n){this.odoo=e,this.shared=t,this.fb=i,this.modal=n,this.isWaitGet=!1}ngOnInit(){this.form=this.fb.group({idOrLink:[void 0,o.s.required]})}getTicketNum(){if(this.form.invalid)return;let e=this.form.value.idOrLink.trim(),t=Number.parseInt(e);if(Number.isNaN(t)){const t=/.*#id=(\d+).*model=helpdesk\.ticket\&.*/gm.exec(e);return Object(Y.g)(t)?void 0:Number.parseInt(t[1])}return t}nzOnCancel(){this.modal.destroy({})}nzOnOk(){if(this.form.invalid)return void this.shared.alert.warning("Vui l\xf2ng nh\u1eadp [ID] ho\u1eb7c [Link] ticket.");let e=this.getTicketNum();Object(Y.i)(e)?this.shared.alert.error("Vui l\xf2ng nh\u1eadp \u0111\xfang \u0111\u1ecbnh d\u1ea1ng [ID] ho\u1eb7c [Link] Ticket."):(this.isWaitGet=!0,this.odoo.ticket.getTicketOdooById(e).subscribe(e=>{this.isWaitGet=!1,this.modal.destroy({data:Object.assign(Object.assign({},e),{is_web:!0})})},t=>{this.isWaitGet=!1,this.shared.alert.error(`[${e}] \u0110\xe3 x\u1ea3y ra l\u1ed7i l\u1ea5y ticket t\u1eeb web.`)}))}}return e.\u0275fac=function(t){return new(t||e)(a.Nb(Oe),a.Nb(K.a),a.Nb(o.e),a.Nb(N.b))},e.\u0275cmp=a.Hb({type:e,selectors:[["app-ticket-web"]],decls:19,vars:3,consts:[[1,"get-ticket-web",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-12"],[1,"form-group"],["for","ticketNumber"],[1,"required"],["nz-input","","placeholder","Nh\u1eadp [ID] ho\u1eb7c [Link] Ticket","id","ticketNumber","formControlName","idOrLink","required","",1,"note"],["nz-button","","type","submit"],["nz-icon","",3,"nzType","nzSpin",4,"ngIf"],["nz-icon","","nzType","save",4,"ngIf"],["nz-button","","type","button",3,"click"],["nz-icon","",3,"nzType","nzSpin"],["nz-icon","","nzType","save"]],template:function(e,t){1&e&&(a.Tb(0,"form",0),a.ac("ngSubmit",(function(){return t.nzOnOk()})),a.Tb(1,"div",1),a.Tb(2,"div",2),a.Tb(3,"div",3),a.Tb(4,"label",4),a.Dc(5,"ID / Link Ticket "),a.Tb(6,"span",5),a.Dc(7,"(*)"),a.Sb(),a.Dc(8,": "),a.Sb(),a.Ob(9,"input",6),a.Sb(),a.Sb(),a.Sb(),a.Tb(10,"div",1),a.Tb(11,"div",2),a.Tb(12,"button",7),a.Bc(13,Le,1,2,"i",8),a.Bc(14,Ee,1,0,"i",9),a.Tb(15,"i"),a.Dc(16,"L\u1ea5y Ticket"),a.Sb(),a.Sb(),a.Tb(17,"button",10),a.ac("click",(function(){return t.nzOnCancel()})),a.Dc(18,"\u0110\xf3ng"),a.Sb(),a.Sb(),a.Sb(),a.Sb()),2&e&&(a.jc("formGroup",t.form),a.zb(13),a.jc("ngIf",t.isWaitGet),a.zb(1),a.jc("ngIf",!t.isWaitGet))},directives:[o.t,o.m,o.h,y.b,o.d,o.l,o.g,o.r,v.a,je.a,T.a,s.n,O.a],styles:[""]}),e})();function Ke(e,t){1&e&&a.Ob(0,"i",15),2&e&&a.jc("nzType","sync")("nzSpin",!0)}function qe(e,t){1&e&&a.Ob(0,"i",16)}let He=(()=>{class e{constructor(e,t,i,n){this.userCtrl=e,this.shared=t,this.fb=i,this.modal=n,this.isWaitGet=!1,this.userDetail=void 0}ngOnInit(){this.userDetail=this.userCtrl.read(),this.form=this.fb.group({email:[{value:this.userDetail.email,disabled:!0},o.s.required],token:[{value:this.userDetail.access_token,disabled:!0},o.s.required],password:[void 0,o.s.required]})}nzOnCancel(){this.modal.destroy({})}nzOnOk(){if(this.form.invalid)return void this.shared.alert.warning("Vui l\xf2ng nh\u1eadp \u0111\u1ea7y \u0111\u1ee7 th\xf4ng tin.");this.isWaitGet=!0;let e=this.form.getRawValue();this.userCtrl.loginTs24(e).subscribe(e=>{this.isWaitGet=!1,this.modal.destroy({data:e})},e=>{this.isWaitGet=!1})}}return e.\u0275fac=function(t){return new(t||e)(a.Nb(G.a),a.Nb(K.a),a.Nb(o.e),a.Nb(N.b))},e.\u0275cmp=a.Hb({type:e,selectors:[["cy-login-ts24"]],decls:35,vars:3,consts:[[1,"get-ticket-web",3,"formGroup","ngSubmit"],[1,"row"],[1,"col-12"],[1,"form-group"],["for","email"],[1,"required"],["nz-input","","placeholder","Nh\u1eadp e-mail","id","email","formControlName","email","type","email","required","",1,"note"],["for","token"],["nz-input","","placeholder","Nh\u1eadp token","id","token","formControlName","token","required","",1,"note"],["for","password"],["nz-input","","placeholder","Nh\u1eadp m\u1eadt kh\u1ea9u TS24","id","password","formControlName","password","type","password","required","",1,"note"],["nz-button","","type","submit",2,"width","unset"],["nz-icon","",3,"nzType","nzSpin",4,"ngIf"],["nz-icon","","nzType","save",4,"ngIf"],["nz-button","","type","button",3,"click"],["nz-icon","",3,"nzType","nzSpin"],["nz-icon","","nzType","save"]],template:function(e,t){1&e&&(a.Tb(0,"form",0),a.ac("ngSubmit",(function(){return t.nzOnOk()})),a.Tb(1,"div",1),a.Tb(2,"div",2),a.Tb(3,"div",3),a.Tb(4,"label",4),a.Dc(5,"E-mail "),a.Tb(6,"span",5),a.Dc(7,"(*)"),a.Sb(),a.Dc(8,": "),a.Sb(),a.Ob(9,"input",6),a.Sb(),a.Sb(),a.Tb(10,"div",2),a.Tb(11,"div",3),a.Tb(12,"label",7),a.Dc(13,"Token "),a.Tb(14,"span",5),a.Dc(15,"(*)"),a.Sb(),a.Dc(16,": "),a.Sb(),a.Ob(17,"input",8),a.Sb(),a.Sb(),a.Tb(18,"div",2),a.Tb(19,"div",3),a.Tb(20,"label",9),a.Dc(21,"MK TS24 "),a.Tb(22,"span",5),a.Dc(23,"(*)"),a.Sb(),a.Dc(24,": "),a.Sb(),a.Ob(25,"input",10),a.Sb(),a.Sb(),a.Sb(),a.Tb(26,"div",1),a.Tb(27,"div",2),a.Tb(28,"button",11),a.Bc(29,Ke,1,2,"i",12),a.Bc(30,qe,1,0,"i",13),a.Tb(31,"i"),a.Dc(32,"L\u1ea5y m\xe3 k\xedch ho\u1ea1t"),a.Sb(),a.Sb(),a.Tb(33,"button",14),a.ac("click",(function(){return t.nzOnCancel()})),a.Dc(34,"\u0110\xf3ng"),a.Sb(),a.Sb(),a.Sb(),a.Sb()),2&e&&(a.jc("formGroup",t.form),a.zb(29),a.jc("ngIf",t.isWaitGet),a.zb(1),a.jc("ngIf",!t.isWaitGet))},directives:[o.t,o.m,o.h,y.b,o.d,o.l,o.g,o.r,v.a,je.a,T.a,s.n,O.a],styles:[""]}),e})();var Pe=i("ICOb");const Ye=["cChanels"],We=["cProduct"],$e=["ngSlSupportHelp"];function Xe(e,t){1&e&&(a.Tb(0,"div",24),a.Tb(1,"div",8),a.Tb(2,"label",25),a.Dc(3,"Ng\xe0y "),a.Tb(4,"span",10),a.Dc(5,"(*)"),a.Sb(),a.Dc(6,": "),a.Sb(),a.Ob(7,"input",26),a.Sb(),a.Sb())}function Qe(e,t){1&e&&(a.Tb(0,"div",24),a.Tb(1,"div",8),a.Tb(2,"label",27),a.Dc(3,"Ticket: "),a.Sb(),a.Ob(4,"input",28),a.Sb(),a.Sb())}function Je(e,t){1&e&&(a.Tb(0,"div",12),a.Tb(1,"div",8),a.Tb(2,"label",29),a.Dc(3,"T\xean NV "),a.Tb(4,"span",10),a.Dc(5,"(*)"),a.Sb(),a.Dc(6,": "),a.Sb(),a.Ob(7,"input",30),a.Sb(),a.Sb())}function Ze(e,t){if(1&e){const e=a.Ub();a.Tb(0,"div",31),a.Tb(1,"div",3),a.Tb(2,"div",12),a.Tb(3,"div",8),a.Tb(4,"label",32),a.Dc(5,"Support Team"),a.Tb(6,"span",10),a.Dc(7,"(*)"),a.Sb(),a.Dc(8,":"),a.Sb(),a.Tb(9,"ng-select",33),a.ac("search",(function(t){return a.sc(e),a.dc().odSearchItem("od_team",t)})),a.Sb(),a.Sb(),a.Sb(),a.Tb(10,"div",12),a.Tb(11,"div",8),a.Tb(12,"label",34),a.Dc(13,"Ph\xe2n c\xf4ng cho"),a.Tb(14,"span",10),a.Dc(15,"(*)"),a.Sb(),a.Dc(16,":"),a.Sb(),a.Tb(17,"ng-select",35),a.ac("search",(function(t){return a.sc(e),a.dc().odSearchItem("od_assign",t)})),a.Sb(),a.Sb(),a.Sb(),a.Tb(18,"div",12),a.Tb(19,"div",8),a.Tb(20,"label",36),a.Dc(21,"Danh m\u1ee5c"),a.Tb(22,"span",10),a.Dc(23,"(*)"),a.Sb(),a.Dc(24,":"),a.Sb(),a.Tb(25,"ng-select",37),a.ac("change",(function(t){return a.sc(e),a.dc().odChangeItem("od_category",t)}))("search",(function(t){return a.sc(e),a.dc().odSearchItem("od_category",t)})),a.Sb(),a.Sb(),a.Sb(),a.Tb(26,"div",12),a.Tb(27,"div",8),a.Tb(28,"label",38),a.Dc(29,"Topic"),a.Tb(30,"span",10),a.Dc(31,"(*)"),a.Sb(),a.Dc(32,":"),a.Sb(),a.Tb(33,"ng-select",39),a.ac("search",(function(t){return a.sc(e),a.dc().odSearchItem("od_topic",t)})),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb()}if(2&e){const e=a.dc();a.zb(9),a.jc("items",e.odWkTeamItems)("virtualScroll",!0)("loading",e.waitObj.od_team),a.zb(8),a.jc("items",e.odAssignItems)("virtualScroll",!0)("loading",e.waitObj.od_assign),a.zb(8),a.jc("virtualScroll",!0)("items",e.odCateItems),a.zb(8),a.jc("virtualScroll",!0)("items",e.odTopicItems)}}function et(e,t){1&e&&(a.Tb(0,"div",17),a.Dc(1,"-------"),a.Sb())}function tt(e,t){1&e&&(a.Tb(0,"div",40),a.Tb(1,"div",8),a.Tb(2,"nz-input-group",41),a.Tb(3,"label",42),a.Dc(4,"M\xe3 s\u1ed1 thu\u1ebf "),a.Tb(5,"span",10),a.Dc(6,"(*)"),a.Sb(),a.Dc(7,": "),a.Sb(),a.Sb(),a.Tb(8,"nz-input-group",41),a.Ob(9,"input",43),a.Ob(10,"input",44),a.Sb(),a.Sb(),a.Sb())}function it(e,t){1&e&&(a.Tb(0,"div",45),a.Tb(1,"div",8),a.Tb(2,"label",46),a.Dc(3,"T\xean kh\xe1ch h\xe0ng: "),a.Sb(),a.Ob(4,"input",47),a.Sb(),a.Sb())}function nt(e,t){if(1&e){const e=a.Ub();a.Tb(0,"div",40),a.Tb(1,"div",8),a.Tb(2,"label"),a.Dc(3,"Email + KH_ID "),a.Tb(4,"span",10),a.Dc(5,"(*)"),a.Sb(),a.Dc(6,": "),a.Sb(),a.Tb(7,"nz-input-group",41),a.Ob(8,"input",48),a.Tb(9,"input",49),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().onChangeKhId(t)})),a.Sb(),a.Sb(),a.Sb(),a.Sb()}}function ot(e,t){1&e&&(a.Tb(0,"div",45),a.Tb(1,"div",8),a.Tb(2,"label",50),a.Dc(3,"S\u1ed1 DT: "),a.Sb(),a.Ob(4,"input",51),a.Sb(),a.Sb())}function st(e,t){1&e&&(a.Tb(0,"div",40),a.Tb(1,"nz-input-group",52),a.Tb(2,"div",53),a.Tb(3,"div",8),a.Tb(4,"label",54),a.Dc(5,"N\u1ed9i dung h\u1ed7 tr\u1ee3 "),a.Tb(6,"span",10),a.Dc(7,"(*)"),a.Sb(),a.Dc(8,": "),a.Sb(),a.Ob(9,"input",55),a.Sb(),a.Sb(),a.Tb(10,"div",56),a.Tb(11,"div",8),a.Tb(12,"label",57),a.Dc(13,"TG ti\u1ebfp nh\u1eadn "),a.Tb(14,"span",10),a.Dc(15,"(*)"),a.Sb(),a.Dc(16,": "),a.Sb(),a.Ob(17,"input",58),a.Sb(),a.Sb(),a.Sb(),a.Sb())}function ct(e,t){1&e&&(a.Tb(0,"div",45),a.Tb(1,"div",8),a.Tb(2,"label",59),a.Dc(3,"Teamviewer: "),a.Sb(),a.Ob(4,"input",60),a.Sb(),a.Sb())}function rt(e,t){1&e&&(a.Tb(0,"div",40),a.Tb(1,"nz-input-group",52),a.Tb(2,"div",53),a.Tb(3,"div",8),a.Tb(4,"label",61),a.Dc(5,"N\u1ed9i dung \u0111\xe3 h\u1ed7 tr\u1ecd "),a.Tb(6,"span",10),a.Dc(7,"(*)"),a.Sb(),a.Dc(8,": "),a.Sb(),a.Ob(9,"input",62),a.Sb(),a.Sb(),a.Tb(10,"div",56),a.Tb(11,"div",8),a.Tb(12,"label",63),a.Dc(13,"TG ho\xe0n th\xe0nh "),a.Tb(14,"span",10),a.Dc(15,"(*)"),a.Sb(),a.Dc(16,": "),a.Sb(),a.Ob(17,"input",64),a.Sb(),a.Sb(),a.Sb(),a.Sb())}function at(e,t){if(1&e){const e=a.Ub();a.Tb(0,"div",45),a.Tb(1,"div",8),a.Tb(2,"label",65),a.Dc(3,"N\u1ed9i dung m\u1eabu: "),a.Sb(),a.Tb(4,"ng-select",66),a.ac("change",(function(t){return a.sc(e),a.dc().onChangeCHelp(t)})),a.Sb(),a.Sb(),a.Sb()}if(2&e){const e=a.dc();a.zb(4),a.jc("items",e.helps)}}function lt(e,t){if(1&e&&(a.Tb(0,"div",12),a.Tb(1,"div",8),a.Tb(2,"label",67),a.Dc(3,"H\xecnh th\u1ee9c h\u1ed7 tr\u1ee3 "),a.Tb(4,"span",10),a.Dc(5,"(*)"),a.Sb(),a.Dc(6,": "),a.Sb(),a.Ob(7,"ng-select",68,69),a.Sb(),a.Sb()),2&e){const e=a.dc();a.zb(7),a.jc("items",e.chanels)("virtualScroll",!0)}}function dt(e,t){if(1&e&&(a.Tb(0,"div",12),a.Tb(1,"div",8),a.Tb(2,"label",70),a.Dc(3,"T\xean ph\u1ea7n m\u1ec1m "),a.Tb(4,"span",10),a.Dc(5,"(*)"),a.Sb(),a.Dc(6,": "),a.Sb(),a.Ob(7,"ng-select",71),a.Sb(),a.Sb()),2&e){const e=a.dc();a.zb(7),a.jc("items",e.SoftNames)("virtualScroll",!0)}}function bt(e,t){1&e&&(a.Tb(0,"div",12),a.Tb(1,"div",8),a.Tb(2,"label",72),a.Dc(3,"T\xean c\xf4ng ty: "),a.Sb(),a.Ob(4,"input",73),a.Sb(),a.Sb())}function ht(e,t){if(1&e&&(a.Tb(0,"div",12),a.Tb(1,"div",8),a.Tb(2,"label",74),a.Dc(3,"S\u1ea3n ph\u1ea9m: "),a.Sb(),a.Ob(4,"ng-select",75,76),a.Sb(),a.Sb()),2&e){const e=a.dc();a.zb(4),a.jc("items",e.products)("virtualScroll",!0)}}function ut(e,t){1&e&&(a.Tb(0,"div",7),a.Tb(1,"div",8),a.Tb(2,"label",82),a.Dc(3,"H\u1ed7 tr\u1ee3 => Copy: "),a.Sb(),a.Ob(4,"textarea",83),a.Sb(),a.Sb())}function pt(e,t){1&e&&(a.Tb(0,"div",7),a.Tb(1,"div",8),a.Tb(2,"label",84),a.Dc(3,"H\u1ed7 tr\u1ee3 => Subject <-> (Y/C nh\u1eadp m\xe3 s\u1ed1 thu\u1ebf) "),a.Sb(),a.Ob(4,"textarea",85),a.Sb(),a.Sb())}function gt(e,t){1&e&&(a.Tb(0,"div",7),a.Tb(1,"div",8),a.Tb(2,"label",86),a.Dc(3,"H\u1ed7 tr\u1ee3 => Body: "),a.Sb(),a.Ob(4,"textarea",87),a.Sb(),a.Sb())}function mt(e,t){1&e&&(a.Tb(0,"div",7),a.Tb(1,"div",8),a.Tb(2,"label",88),a.Dc(3,"H\u1ed7 tr\u1ee3 => Note: "),a.Sb(),a.Ob(4,"textarea",89),a.Sb(),a.Sb())}const ft=function(){return{standalone:!0}};function Tt(e,t){if(1&e){const e=a.Ub();a.Tb(0,"div",77),a.Tb(1,"div",3),a.Bc(2,ut,5,0,"div",78),a.Bc(3,pt,5,0,"div",78),a.Bc(4,gt,5,0,"div",78),a.Bc(5,mt,5,0,"div",78),a.Sb(),a.Tb(6,"div",79),a.Tb(7,"label",80),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().isAutoCreate=t}))("click",(function(){return a.sc(e),a.dc().onClickAutoCreate()})),a.Dc(8,"T\u1ef1 \u0111\u1ed9ng t\u1ea1o > Copy"),a.Sb(),a.Tb(9,"label",81),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().isAutoInput=t})),a.Dc(10,"[TS] T\u1ef1 \u0111\u1ed9ng \u0111i\u1ec1n"),a.Sb(),a.Tb(11,"label",80),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().isViewAll=t}))("click",(function(){return a.sc(e),a.dc().onClickShowMore()})),a.Dc(12,"Hi\u1ec3n th\u1ecb ALL"),a.Sb(),a.Tb(13,"label",80),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().isViewColOdoo=t}))("click",(function(){return a.sc(e),a.dc().onClickShowOdoo()})),a.Dc(14,"Hi\u1ec3n th\u1ecb c\u1ed9t TS24"),a.Sb(),a.Tb(15,"label",81),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().isSaveCache=t})),a.Dc(16,"L\u01b0u Cache"),a.Sb(),a.Tb(17,"label",81),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().isViewTicket=t})),a.Dc(18,"\u1ea8n Danh s\xe1ch"),a.Sb(),a.Tb(19,"label",81),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().chkQuestion=t})),a.Dc(20,"L\u01b0u n\u1ed9i dung m\u1eabu"),a.Sb(),a.Sb(),a.Sb()}if(2&e){const e=a.dc();a.zb(2),a.jc("ngIf",!e.isViewAll),a.zb(1),a.jc("ngIf",e.isViewAll),a.zb(1),a.jc("ngIf",e.isViewAll),a.zb(1),a.jc("ngIf",e.isViewAll),a.zb(2),a.jc("ngModel",e.isAutoCreate)("ngModelOptions",a.lc(18,ft)),a.zb(2),a.jc("ngModel",e.isAutoInput)("ngModelOptions",a.lc(19,ft)),a.zb(2),a.jc("ngModel",e.isViewAll)("ngModelOptions",a.lc(20,ft)),a.zb(2),a.jc("ngModel",e.isViewColOdoo)("ngModelOptions",a.lc(21,ft)),a.zb(2),a.jc("ngModel",e.isSaveCache)("ngModelOptions",a.lc(22,ft)),a.zb(2),a.jc("ngModel",e.isViewTicket)("ngModelOptions",a.lc(23,ft)),a.zb(2),a.jc("ngModel",e.chkQuestion)("ngModelOptions",a.lc(24,ft))}}function kt(e,t){1&e&&a.Ob(0,"i",108),2&e&&a.jc("nzType","sync")("nzSpin",!0)}function _t(e,t){1&e&&a.Ob(0,"i",109)}function St(e,t){if(1&e&&(a.Tb(0,"button",106),a.Bc(1,kt,1,2,"i",97),a.Bc(2,_t,1,0,"i",107),a.Dc(3),a.Sb()),2&e){const e=a.dc(2);a.jc("disabled",e.ticketForm.invalid||e.disabledAction),a.zb(1),a.jc("ngIf",e.isSaveTicket),a.zb(1),a.jc("ngIf",!e.isSaveTicket),a.zb(1),a.Fc("",e.isUpdateTicket?"C\u1eadp nh\u1eadt":"L\u01b0u l\u1ea1i"," ")}}function Ot(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",94),a.ac("click",(function(){return a.sc(e),a.dc(2).onDeleteTicket()})),a.Ob(1,"i",110),a.Dc(2,"X\xf3a Ticket "),a.Sb()}if(2&e){const e=a.dc(2);a.jc("disabled",e.disabledAction)}}function Ct(e,t){1&e&&a.Ob(0,"i",111)}function jt(e,t){1&e&&a.Ob(0,"i",108),2&e&&a.jc("nzType","sync")("nzSpin",!0)}function zt(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",94),a.ac("click",(function(){return a.sc(e),a.dc(2).onCreateNew()})),a.Ob(1,"i",112),a.Dc(2,"T\u1ea1o m\u1edbi "),a.Sb()}if(2&e){const e=a.dc(2);a.jc("disabled",e.disabledAction)}}function yt(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",94),a.ac("click",(function(){return a.sc(e),a.dc(2).onFindPartner()})),a.Ob(1,"i",113),a.Tb(2,"span"),a.Dc(3,"T\xecm KH"),a.Sb(),a.Sb()}if(2&e){const e=a.dc(2);a.jc("disabled",e.disabledAction)}}function vt(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",103),a.ac("click",(function(){return a.sc(e),a.dc(2).autoFixTicket()})),a.Ob(1,"i",113),a.Dc(2,"S\u1eeda l\u1ed7i ticket "),a.Sb()}}function wt(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",103),a.ac("click",(function(){return a.sc(e),a.dc(2).onCopyTicketWeb()})),a.Ob(1,"i",104),a.Dc(2,"L\u1ea5y ticket "),a.Sb()}}function Dt(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",103),a.ac("click",(function(){return a.sc(e),a.dc(2).onCopyTicket()})),a.Ob(1,"i",104),a.Dc(2,"Sao ch\xe9p "),a.Sb()}}function It(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",103),a.ac("click",(function(){return a.sc(e),a.dc(2).onTest()})),a.Ob(1,"i",113),a.Dc(2,"onTest() "),a.Sb()}}function xt(e,t){1&e&&a.Ob(0,"i",108),2&e&&a.jc("nzType","sync")("nzSpin",!0)}function At(e,t){if(1&e){const e=a.Ub();a.Tb(0,"button",114),a.ac("click",(function(){return a.sc(e),a.dc(2).onOpenUserConfig()})),a.Ob(1,"i",115),a.Bc(2,xt,1,2,"i",97),a.Tb(3,"span"),a.Dc(4,"C\xe0i m\u1eb7c \u0111\u1ecbnh"),a.Sb(),a.Sb()}if(2&e){const e=a.dc(2);a.jc("disabled",e.disabledAction),a.zb(2),a.jc("ngIf",e.isUpdateUser)}}function Ft(e,t){if(1&e){const e=a.Ub();a.Tb(0,"div",90),a.Tb(1,"div",91),a.Bc(2,St,4,4,"button",92),a.Bc(3,Ot,3,1,"button",93),a.Tb(4,"button",94),a.ac("click",(function(){return a.sc(e),a.dc().onCompleteTicket()})),a.Ob(5,"i",95),a.Dc(6,"Ho\xe0n th\xe0nh "),a.Sb(),a.Tb(7,"button",94),a.ac("click",(function(){return a.sc(e),a.dc().onLoadCatalog()})),a.Bc(8,Ct,1,0,"i",96),a.Bc(9,jt,1,2,"i",97),a.Tb(10,"span"),a.Dc(11,"T\u1ea3i Danh m\u1ee5c"),a.Sb(),a.Sb(),a.Bc(12,zt,3,1,"button",93),a.Bc(13,yt,4,1,"button",93),a.Tb(14,"button",98),a.Ob(15,"i",99),a.Tb(16,"span"),a.Dc(17,"+ Kh\xe1c"),a.Sb(),a.Sb(),a.Tb(18,"nz-dropdown-menu",null,100),a.Tb(20,"ul",101),a.Bc(21,vt,3,0,"li",102),a.Bc(22,wt,3,0,"li",102),a.Tb(23,"li",103),a.ac("click",(function(){return a.sc(e),a.dc().onUpdateApiKey()})),a.Ob(24,"i",104),a.Dc(25,"M\xe3 k\xedch ho\u1ea1t "),a.Sb(),a.Bc(26,Dt,3,0,"li",102),a.Bc(27,It,3,0,"li",102),a.Sb(),a.Sb(),a.Bc(28,At,5,2,"button",105),a.Sb(),a.Sb()}if(2&e){const e=a.rc(19),t=a.dc();a.zb(2),a.jc("ngIf",t.isRole("create")),a.zb(1),a.jc("ngIf",t.isUpdateTicket&&t.isRole("delete")),a.zb(1),a.jc("disabled",t.disabledAction),a.zb(3),a.jc("disabled",t.disabledAction),a.zb(1),a.jc("ngIf",!t.isAsyncCatalog),a.zb(1),a.jc("ngIf",t.isAsyncCatalog),a.zb(3),a.jc("ngIf",t.isRole("create")),a.zb(1),a.jc("ngIf",t.isRole("find_kh")),a.zb(1),a.jc("disabled",t.disabledAction)("nzDropdownMenu",e),a.zb(7),a.jc("ngIf",t.isRole("fix_row")),a.zb(1),a.jc("ngIf",t.isRole("get_tweb")),a.zb(4),a.jc("ngIf",t.isRole("copy")),a.zb(1),a.jc("ngIf",t.isRole("test")),a.zb(1),a.jc("ngIf",t.isRole("cfig_def"))}}let Vt=(()=>{class e{constructor(t,i,n,o,s,c,r,l){this.aRouter=t,this.nzModal=i,this.fb=n,this.shared=o,this.ticketCtrl=s,this.odoo=c,this.user=r,this.ngCfig=l,this.logger=new Pe.a(e),this._userCache={},this.save=new a.n,this.remove=new a.n,this.asyncInput=new a.n(!1),this.isInitPageChange=new a.n(!1),this.handlerLoadCate=new a.n,this.isCreateNew=!0,this.isInitPage=!0,this.userCfigModalRef=void 0,this.isViewSetDefault=!1,this.inputUserCfigObj={id:"#UserConfig"},this.acceptEditPartner=!0,this.isViewTicket=!0,this.isAutoLoadCate=!0,this.userDetail=new Ue.a,this.editTicket=null,this.isSaveTicket=!1,this.isAsyncCatalog=!1,this.setDataFromOther=void 0,this.isAutoCreate=!0,this.isAutoInput=!1,this.isViewAll=!1,this.isViewColOdoo=!1,this.isAutoOpenSaveCfigDef=!1,this.chkQuestion=!1,this.isSaveCache=!1,this.isUpdateUser=!1,this.ghelps=[],this.helps=[],this.chanels=[],this.softwares=[],this.products=[],this.odWkTeamItems=[],this.odAssignItems=[],this.odTopicItems=[],this.odCateItems=[],this.waitObj={od_category:!1,od_team:!1,od_assign:!1,od_topic:!1},this.OD_KEYS={cate:"od_category",team:"od_team",assign:"od_assign",topic:"od_topic",partner:"od_partner"},this.isClickSaveDef=!1,this.isCheckImage=!1,this.ticketNumber=void 0,this.ticketDefault=void 0}ngOnInit(){this.aRouter.queryParamMap.subscribe(e=>{this.isAutoOpenSaveCfigDef=Object(Y.m)(e.get("save_default"))}),this.ngCfig.notFoundText="Kh\xf4ng c\xf3 d\xf2ng n\xe0o.",this.ngCfig.clearAllText="X\xf3a d\u1eef li\u1ec7u",this.isInitPage=!0,this.userDetail=this.user.read(),this.initAutoChk(),this.isAutoLoadCate?this.onLoadCatalog():this.loadCateFromCookie(this.shared.catalogs),this.createFormGroup()}ngOnChanges(e){}loadCateFromCookie(e){e=e||this.shared.catalogs,Promise.resolve(e).then(e=>Object(d.a)(this,void 0,void 0,(function*(){let t=yield e;this.helps=t.questions||[],this.chanels=t.chanels||[],this.softwares=t.softwares||[],this.ghelps=t.group_helps||[],this.odWkTeamItems=t.od_team||[],this.odCateItems=t.od_category||[],this.odAssignItems=t.od_assign||[],this.odTopicItems=t.od_topic||[]}))).then(e=>{this.onCreateNew(),this.isInitPage=!1})}initAutoChk(){let e=this.userDetail.config.auto_create;this.isAutoCreate=void 0===e||e,this.isViewAll=this.userDetail.config.view_all,this.isSaveCache=this.userDetail.config.save_cache,this.isViewColOdoo=this.userDetail.config.show_ts24,this.isAutoInput=this.isAutoInput||this.userDetail.config.auto_input}ngAfterViewInit(){}odSearchItem(e,t){let i="string"==typeof t?t:t.term;if(!(Object(Y.l)(i)||i.length<3))switch(e){case this.OD_KEYS.assign:this.waitObj.od_assign=!0,this.odoo.user.nameSearch(i).subscribe(e=>{this.odAssignItems=e,this.waitObj.od_assign=!1});break;case this.OD_KEYS.team:this.waitObj.od_team=!0,this.odoo.team.nameSearch(i).subscribe(e=>{this.odWkTeamItems=e,this.waitObj.od_team=!1})}}odChangeItem(e,t,i=!0){if(e===this.OD_KEYS.cate&&!Object(Y.i)(t)){i=!1!==i&&this.isAutoInput;let e=this.ticketForm.get(this.OD_KEYS.team);if(Object(Y.i)(e.value)||Object(Y.g)(e.value)||i){let i=t.wk_team;Object(Y.h)(i)||(this.odWkTeamItems=[i,...this.odWkTeamItems.slice(1)]),e.setValue(i)}let n=this.ticketForm.get(this.OD_KEYS.assign);if(Object(Y.i)(n.value)||i){this.odAssignItems=[this.userDetail.od_user,t.manager];let e=this.odAssignItems.filter(e=>!0===e.is_select)[0]||this.odAssignItems[0];n.setValue(e)}let o=this.OD_KEYS.topic,s=this.ticketForm.get(o);if(Object(Y.i)(s.value)||i){let e=this.odTopicItems.filter(e=>e.category_id[0]===t.id);this.ticketForm.get(o).setValue(e[0])}}}get ticket(){return this.formValue}isRole(e,t){return this.user.read().isRole(e,t)}set ticket(e){this.isInitPage?this.editTicket=e:(this.setDataFromOther=!0,this.setTicket(e))}setTicket(e,t=!0){if(Object.keys(e||{}).forEach(t=>{let i=e[t],n=i instanceof Array&&Object(Y.g)(i),o=i instanceof Object&&Object(Y.h)(i);(Object(Y.i)(i)||n||o)&&delete e[t]}),this.ticketDefault=t?this.createTicketDefault():{showMore:!1,tAuto:!0,showColOdoo:!1},e=Object.assign(this.ticketDefault,e),this.isCreateNew=Object(Y.l)(e.ticket_id),Object(Y.i)(this.ticketForm)&&this.createFormGroup(),!Object(Y.l)(e.ticket_id)){let t=e[this.OD_KEYS.cate]||{},i=this.odCateItems.filter(e=>e.id===t.id);i.length>0&&(e[this.OD_KEYS.cate]=i[0])}if(Object(Y.i)(e.support_help)&&!Object(Y.g)(e.chanels)&&(e.support_help=e.chanels[e.chanels.length-1]),Object(Y.i)(e.soft_name)&&!Object(Y.i)(e.software)&&(e.soft_name=e.software.soft_names[0]),!Object(Y.i)(e.group_help)&&Object(Y.i)(e.group_help.title)){let t=e.group_help.id,i=this.ghelps.filter(e=>e.id===t);e.group_help=i.length>0?i[0]:e.group_help}if(Object(Y.i)(e.product_id)||this.products.forEach(t=>{t.extend_id!==e.product_id||(e.product=t)}),!Object(Y.h)(e.od_image)){let t=Object.keys(e.od_image)||[];t.length>0&&(e.image_name=t.map(e=>e.replace(".png","")).join(";"),this.setEnableFC("image_name",Object(Y.j)(e.is_upfile,!1)))}e.body=Object(Y.l)(e.body)?!0===this.isAutoCreate?X(e).join("\n"):")":e.body,e.note=Object(Y.l)(e.note)?!0===this.isAutoCreate?Q(e).join("\n"):"":e.note,e.subject=Object(Y.l)(e.subject)?!0===this.isAutoCreate?J(e):"":e.subject,e.content_copy=Object(Y.l)(e.content_copy)?!0===this.isAutoCreate?$(e,!this.isViewAll):"khong co":e.content_copy,0===e.od_khid&&(e.od_khid=void 0),this.update_contentCopy(e.content_copy),this.update_helpdeskBody(e.content_copy),this.update_helpdeskNote(e.note),this.update_helpdeskSubject(e.subject),Y.f.log(e.subject,this.isAutoCreate),this.ticketNumber=e.ticket_number,this.resetForm(e),this.asyncInput.emit(!1),this.isCreateNew=Object(Y.i)(e.ticket_id)}setEnableFC(e,t){let i=this.ticketForm.get(e);t?i.enable():i.disable()}resetForm(e){this.ticketForm.reset(Object.assign({},e)),this.odChangeItem(this.OD_KEYS.cate,e[this.OD_KEYS.cate],!1)}get formValue(){return Object(Y.i)(this.ticketForm)?{}:Object.assign({},this.ticketForm.getRawValue())}get isUpdateTicket(){return!Object(Y.i)(this.ticket)&&!Object(Y.i)(this.ticket.ticket_id)}get SoftNames(){const e=this.formValue.software;return Object(Y.i)(e)?[]:e.soft_names}updateFValue(e,t){this.ticketForm.get(e).setValue(t)}changeEnableOrDisableCHelp(){const e=this.ticketForm.get("content_help"),t=this.ticketForm.get("content_required"),i=this.ticketForm.get("help");e.valueChanges.subscribe(e=>{Object(Y.l)(e)||Object(Y.l)(t.value)?i.enable():i.disable()}),t.valueChanges.subscribe(t=>{Object(Y.l)(t)||Object(Y.l)(e.value)?i.enable():i.disable()})}pathValue(e,t){this.ticketForm.patchValue({[e]:t}),!0===this.isAutoCreate&&this.autoFixTicket()}onLoadCatalog(e){this.logger.log("------ onLoadCatalog() ------- "),this.isAsyncCatalog=!0;let t=this.shared.loading("L\u1ea5y d\u1eef li\u1ec7u danh m\u1ee5c"),i=this.ticketCtrl.loadCatalogs(!0).pipe(Object(b.a)(e=>{this.chanels=e.chanels,this.helps=e.questions,this.ghelps=e.group_helps,this.softwares=e.softwares,this.products=e.products,this.odCateItems=e[this.OD_KEYS.cate]||[],this.odTopicItems=e[this.OD_KEYS.topic]||[];let t=e[this.OD_KEYS.team]||[];if(this.odWkTeamItems=[{display_name:"-- Ch\u1ecdn Team --"},...t],Object(Y.i)(this.formValue[this.OD_KEYS.team])&&1===t.length){let e=t[0].manager,i={id:e[0],display_name:e[1]};this.ticketForm.get(this.OD_KEYS.team).setValue(t[0]),this.ticketForm.get(this.OD_KEYS.assign).setValue(i)}return Object(ne.a)(e)})),n=!1,o=Object(ne.a)(i).pipe(Object(Z.a)(e=>e.pipe(Object(ee.a)(1e3)))).subscribe(()=>{},e=>{n=!0,o.unsubscribe()});this.handlerLoadCate.emit(o);let s=Object(oe.a)(100).subscribe(i=>{if(o.closed){if(this.isAsyncCatalog=!1,this.shared.alert.remove(t.messageId),n||(this.shared.alert.success("\u0110\xe3 l\u1ea5y xong danh m\u1ee5c"),this.shared.catalogs=Object.assign(Object.assign({},this.shared.catalogs),{isAutoLoadCate:!1}),this.isAutoLoadCate=!1,this.isAutoOpenSaveCfigDef&&this.onOpenUserConfig()),this.isInitPage){let t=!0===e?this.fixFormValIsNull(this.editTicket||this.formValue||{}):this.editTicket;this.setTicket(t),this.isInitPage=!1}s.unsubscribe()}},Object(te.a)(1))}fixFormValIsNull(e){return Object.keys(e).map(t=>{let i=e[t];return Array.isArray(i)?Object(Y.g)(i)&&(i=void 0):"object"==typeof i?Object(Y.h)(i)&&(i=void 0):Object(Y.l)(i)&&(i=void 0),{[t]:i}}).reduce((e,t)=>Object.assign(Object.assign({},e),t),{})}onClickAutoCreate(){!0===this.isAutoCreate&&this.autoFixTicket()}onCreateNew(e){Y.f.log(" -- onCreateNew() --"),e=Object.assign({},e),this.setDataFromOther=void 0,this.save.emit({ticket:void 0,isNew:!0}),this.setTicket(e,!0)}onCopyTicket(){let e=this.formValue;delete e.ticket_id,this.setDataFromOther=void 0,this.setTicket(e,!1)}addDayDate(e,t){return e.setMinutes(e.getMinutes()+t),e}onCompleteTicket(){this.pathValue("complete_time",new s.d("en-US").transform(new Date,"yyyyMMdd-HH:mm"))}onOpenUserConfig(){this.userCfigModalRef=this.nzModal.create({nzWidth:700,nzMaskClosable:!1,nzClosable:!1,nzClassName:"user-config",nzTitle:"L\u01b0u d\u1eef li\u1ec7u m\u1eb7c \u0111\u1ecbnh",nzContent:e,nzOkText:"Luu m\u1eb7c \u0111\u1ecbnh",nzCancelText:"\u0110\xf3ng",nzComponentParams:{isViewCfigDef:this.userDetail.roles.cfig_def_input,isViewSetDefault:!0,isAutoInput:!0,isAutoLoadCate:!1},nzOnCancel:()=>"close",nzOnOk:()=>this.updateUserConfig().pipe(Object(ie.a)(e=>this.isClickSaveDef=!0)).toPromise()}),this.userCfigModalRef.afterClose.subscribe(e=>{"object"==typeof e&&(this._userCache={},this.isAutoOpenSaveCfigDef=!1)})}onChangeKhId(e){let t=Object(Y.l)(e)||0===Number.parseInt(e);["tax_code","customer_name","email","company_name"].forEach(e=>{const i=this.ticketForm.get(e);t?i.enable():i.disable({emitEvent:!0})})}updateUserConfig(){return se.a.create(e=>{Y.f.log("updateUserConfig","C\u1eadp nh\u1eadt c\u1ea5u h\xecnh ng\u01b0\u1eddi d\xf9ng.");let t=this.userCfigModalRef.getContentComponent();this.isUpdateUser=!0;let i=this.shared.loading("<b>C\u1eadp nh\u1eadt danh m\u1ee5c m\u1eb7c \u0111\u1ecbnh.</b>"),n=this.user.read(),o=t.formValue,s={name:o.full_name,val_def:{chanel_ids:Object(Y.g)(o.chanels)?[]:o.chanels.map(e=>e.chanel_id),ghelp_id:Object(Y.i)(o.group_help)?0:o.group_help.id,software_id:Object(Y.i)(o.software)?0:o.software.id,product_id:Object(Y.i)(o.product)?0:o.product.extend_id,support_help_id:Object(Y.i)(o.support_help)?0:o.support_help.chanel_id,od_team_id:Object(Y.i)(o[this.OD_KEYS.team])?0:o[this.OD_KEYS.team].id,od_category_id:Object(Y.i)(o[this.OD_KEYS.cate])?0:o[this.OD_KEYS.cate].id,od_topic_id:Object(Y.i)(o[this.OD_KEYS.topic])?0:o[this.OD_KEYS.topic].id,od_assign_id:Object(Y.i)(o[this.OD_KEYS.assign])?0:o[this.OD_KEYS.assign].id,soft_name:o.soft_name},config:{show_ts24:this.isViewColOdoo,auto_create:this.isAutoCreate,auto_input:this.isAutoInput}};Object(Y.l)(o.od_user_def)||(s.odoo_user=JSON.parse(o.od_user_def||{})),Object(Y.l)(o.cookie_value)||(s.cookie_value=o.cookie_value),Object(Y.l)(o.csrf_token)||(s.csrf_token=o.csrf_token),this.user.updateOne(n.id,s).subscribe(t=>{this.isUpdateUser=!1,this.shared.alert.remove(i.messageId),this.shared.alert.success("C\u1eadp nh\u1eadt d\u1eef li\u1ec7u m\u1eb7c \u0111\u1ecbnh xong."),e.next(t),e.complete()},t=>{this.isUpdateUser=!1,this.shared.alert.remove(i.messageId),e.error(t)})})}onCopyTicketWeb(){this.nzModal.create({nzTitle:"L\u1ea5y ticket t\u1eeb Odoo",nzClosable:!1,nzContent:Ge,nzMaskClosable:!1,nzOkText:"L\u1ea5y Ticket",nzCancelText:"\u0110\xf3ng",nzFooter:null}).afterClose.subscribe(e=>{if(!Object(Y.i)(e)&&!Object(Y.h)(e.data)){this.shared.alert.success("\u0110\xe3 l\u1ea5y xong ticket t\u1eeb web.");let t=Object.assign(Object.assign({},e.data),{chanels:void 0,source_text:"odoo"});this.onCreateNew(t)}})}onSaveTicket(e=!0){!0===e&&this.ticketForm.invalid?this.shared.showError({error:{code:"230",message:"Ch\u01b0a nh\u1eadp \u0111\u1ea7y \u0111\u1ee7 th\xf4ng tin"}}):new se.a(e=>{Object(Y.l)(this.ticketNumber)?(e.next("update"),e.complete()):this.nzModal.create({nzTitle:"Th\xf4ng b\xe1o",nzClosable:!1,nzContent:"Ticket n\xe0y \u0111\xe3 t\u1ea1o tr\xean Odoo -> <b>B\u1ea1n c\xf3 mu\u1ed1n c\u1eadp nh\u1eadt l\u1ea1i th\xf4ng tin tr\xean h\u1ec7 th\u1ed1ng.</b>",nzMaskClosable:!1,nzOkText:"C\u1eadp nh\u1eadt",nzCancelText:"Th\xf4i b\u1ecf",nzOnOk:()=>Promise.resolve("update")}).afterClose.subscribe(t=>{e.next(t),e.complete()})}).subscribe(e=>{if("update"===e){this.isSaveTicket=!0;let e={},t=[this.getAndValidateTicket(),this.handleSaveTicket(e)],i=!1,n=Object(ne.a)(...t).pipe(Object(Z.a)(e=>e)).subscribe(t=>{this.logger.log("K\u1ebft qu\u1ea3: Oki"),e=Object.assign(e,t)},e=>{this.logger.log("K\u1ebft qu\u1ea3: Error"),this.logger.log(e),null!=n&&n.unsubscribe(),i=!0}),o=Object(oe.a)(1e3).subscribe(e=>{n.closed&&(this.isSaveTicket=!1,o.unsubscribe())})}})}getAndValidateTicket(){return new se.a(e=>{this.logger.log("getAndValidateTicket() -> Chu\u1ea9n b\u1ecb d\u1eef li\u1ec7u l\u01b0u + c\u1eadp nh\u1eadt ticket");const t=this.formValue,i=this.user.read();if(t.user_id=i.id,t.body=t.body,t.note=t.note,t.subject=t.subject,t.content_copy=t.content_copy,t.ticket_number=Object(Y.l)(t.ticket_number)?null:t.ticket_number,t.chanel_ids=t.chanels.map(e=>e.chanel_id),t.product_id=Object(Y.i)(t.product)?null:t.product.extend_id,t.software_id=Object(Y.i)(t.software)?null:t.software.id,t.support_help_id=Object(Y.i)(t.support_help)?null:t.support_help.chanel_id,t.group_help_id=Object(Y.i)(t.group_help)?null:t.group_help.id,t.od_category=Object.assign({},t.od_category),!Object(Y.h)(t.od_assign)){let e=t.od_assign;t.od_assign={id:e.id,name:e.name,display_name:e.display_name}}Object(Y.l)(t.image_name)||(t.od_image=Y.a.reduce(t.image_name.split(";"),e=>({[e]:null}))),this.chkQuestion&&(t.question_save={title:t.content_required,question:t.content_required,reply:t.content_help,type:t.od_category.id,user_id:this.userDetail.id,is_shared:!1}),!0===this.isSaveCache?(this.shared.setByKey("isAutoCreate",this.isAutoCreate),this.shared.setByKey("isViewAll",this.isViewAll),this.shared.setByKey("isSaveCache",this.isSaveCache),this._userCache={chanels:t.chanels,ghelp:Object.assign({},t.group_help),software:Object.assign({},t.software),support_help:Object.assign({},t.support_help),soft_name:t.soft_name,product_id:Object(Y.i)(t.product)?void 0:t.product.extend_id,od_team:Object.assign({},t.od_team),od_category:Object.assign({},t.od_category),od_assign:Object.assign({},t.od_assign),od_topic:Object.assign({},t.od_topic)},Y.f.log("L\u01b0u cache: ",this._userCache)):this._userCache={};const n=Object.assign({},t);["od_user_def","cookie_value","csrf_token","help","chanels","product","software","support_help","first_chanel","group_help","image_name"].forEach(e=>delete n[e]);let o=n[this.OD_KEYS.cate];["wk_team","manager","sequence"].forEach(e=>delete o[e]);let s=n[this.OD_KEYS.topic];["description","sequence"].forEach(e=>delete s[e]),e.next(Object.assign({},n)),e.complete()})}handleSaveTicket(e){return new se.a(t=>{let i=e.ticket_id;Object(Y.l)(i)?(this.logger.log("handleSaveTicket() -> T\u1ea1o m\u1edbi ticket"),this.ticketCtrl.addOne(e).subscribe(e=>{this.editTicket=e,this.setTicket(e,!1),this.save.emit({ticket:e,isNew:Object(Y.i)(this.setDataFromOther)}),this.shared.alert.success(`[${e.ticket_id}] Th\xeam m\u1edbi ticket th\xe0nh c\xf4ng.`),this.isSaveTicket=!1,this.asyncInput.emit(!1),this.updateQuestion(e),t.next(e),t.complete()},e=>t.error(e))):(this.logger.log("handleSaveTicket() -> C\u1eadp nh\u1eadt ticket"),this.ticketCtrl.updateOne(i,e).subscribe(e=>{this.setTicket(e,!1),this.save.emit({ticket:e,isNew:!1}),this.shared.alert.success(`[${e.ticket_id}] C\u1eadp nh\u1eadt ticket th\xe0nh c\xf4ng.`),this.isSaveTicket=!1,this.asyncInput.emit(!1),this.updateQuestion(e),t.next(e),t.complete()},e=>t.error(e)))})}updateQuestion(e){let t=e.question_save;Object(Y.h)(t)||(this.helps=[...this.helps,t])}onDeleteTicket(){Object(Y.i)(this.ticket.ticket_id)?this.shared.alert.warning("Ch\u1ecdn l\u1ea1i d\xf2ng ticket c\u1ea7n x\xf3a."):this.nzModal.confirm({nzTitle:"B\u1ea1n mu\u1ed1n x\xf3a ticket n\xe0y ?",nzCancelText:"H\u1ee7y b\u1ecf",nzOkText:"X\xf3a",nzOnOk:()=>this.ticketCtrl.deleteOne(this.ticket.ticket_id).toPromise().then(()=>{this.remove.emit(this.ticket),this.shared.alert.success(`[${this.ticket.ticket_id}] \u0110\xe3 x\xf3a ticket xong.`),this.onCreateNew()})})}onClickShowMore(){this._userCache.showMore=this.isViewAll}onClickShowOdoo(){this._userCache.showColOdoo=this.isViewColOdoo}onChangeCHelp(e){const t=this.formValue;Object(Y.l)(t.content_required)&&this.pathValue("content_required",e.question||""),Object(Y.l)(t.content_help)&&(this.pathValue("content_help",e.reply),Object(Y.l)(t.complete_time)&&this.onCompleteTicket())}createFormGroup(){this.ticketForm=this.fb.group({ticket_id:null,user_code:null,ticket_on:[null,o.s.required],ticket_number:null,ticket_text:null,full_name:null,tax_code:[null,o.s.required],chkQuestion:!1,company_name:null,email:null,phone:null,teamviewer:null,customer_name:null,content_required:null,content_help:null,reception_time:null,complete_time:null,software:[null,o.s.required],chanels:[null,o.s.required],content_copy:null,first_chanel:null,help:[null],group_help:null,support_help:null,soft_name:null,product:null,body:null,note:null,subject:null,image_name:null,od_image:null,od_team:[null],od_assign:[null],od_category:[null],od_topic:null,od_khid:[0],od_partner:null,od_user_def:null,cookie_value:null,csrf_token:null}),this.formValueChange()}formValueChange(){this.ticketForm.get("content_help").valueChanges.subscribe(e=>{Object(Y.l)(this.formValue.complete_time)&&!Object(Y.l)(e)&&this.onCompleteTicket()}),this.ticketForm.get("chanels").valueChanges.subscribe(e=>{Object(Y.g)(e)||this.pathValue("support_help",e[e.length-1])}),this.ticketForm.get("software").valueChanges.subscribe(e=>{Object(Y.i)(e)||Object(Y.g)(e.soft_names)||this.ticketForm.get("soft_name").setValue(e.soft_names[0])}),this.ticketForm.valueChanges.subscribe(e=>{this.ticketForm.dirty&&(this.asyncInput.emit(!0),!0===this.isAutoCreate&&this.autoFixTicket())})}update_helpdeskBody(e){this.ticketForm.get("body").patchValue(e,{onlySelf:!0})}update_helpdeskNote(e){this.ticketForm.get("note").patchValue(e,{onlySelf:!0})}update_helpdeskSubject(e){this.ticketForm.get("subject").patchValue(e,{onlySelf:!0})}update_contentCopy(e){this.ticketForm.get("content_copy").patchValue(e,{onlySelf:!0})}autoFixTicket(e,t){if(console.info("autoFixTicket"),e=e||this.formValue,Object(Y.m)(t)){let t=this.createTicketDefault();this.fixCompleteTime(20,"minute"),this.fixTicketOn_fromReception_time(),Object(Y.g)(e.chanels)&&!Object(Y.g)(t.chanels)&&this.pathValue("chanels",t.chanels),Object(Y.h)(e.software)&&!Object(Y.h)(t.software)&&this.pathValue("software",t.software),Object(Y.h)(e.group_help)&&!Object(Y.h)(t.group_help)&&this.pathValue("group_help",t.group_help),Object(Y.h)(e.od_team)&&!Object(Y.h)(t.od_team)&&this.pathValue("od_team",t.od_team),Object(Y.h)(e.od_assign)&&!Object(Y.h)(t.od_assign)&&this.pathValue("od_assign",t.od_assign),Object(Y.h)(e.od_category)&&!Object(Y.h)(t.od_category)&&this.pathValue("od_category",t.od_category),Object(Y.h)(e.od_topic)&&!Object(Y.h)(t.od_topic)&&this.pathValue("od_topic",t.od_topic)}let i=X(e).join("\n");this.update_helpdeskBody(i);let n=Q(e).join("\n");this.update_helpdeskNote(n);let o=J(e);this.update_helpdeskSubject(o);let s=$(e,!1,{body:i,note:n,subject:o});return this.update_contentCopy(s),this.formValue}fixTicketOn_fromReception_time(){let e=this.formValue.reception_time;if(!Object(Y.l)(e)){e=e.replace(/ /g,"");let t=e.substring(2,8);this.ticketForm.get("ticket_on").patchValue(t),this.ticketForm.get("reception_time").patchValue(e)}}fixCompleteTime(e=20,t="minute"){let i=this.formValue.reception_time;if(Object(Y.l)(i))return;let n=this.formValue.complete_time;if(!Object(Y.l)(i)&&(Object(Y.l)(n)||12==n.length||i==n)){let n=i,o=new Date(Number.parseInt(n.substring(0,4)),Number.parseInt(n.substring(4,6))-1,Number.parseInt(n.substring(6,8)),Number.parseInt(n.substring(9,11)),Number.parseInt(n.substring(12,14)));console.log(Number.parseInt(n.substring(4,6))),console.log(Y.c.dateToString(o,"yyyyMMdd-HH:mm"));let s=Y.c.dateAdd(o,t,e),c=Y.c.dateToString(s,"yyyyMMdd-HH:mm");this.ticketForm.get("complete_time").patchValue(c)}}createTicketDefault(e){const t=this.user.read(),i=t.val_def||{},n=this._userCache;if(Object(Y.g)(n.chanels)){const e=i.chanel_ids||[];n.chanels=this.chanels.filter(t=>e.indexOf(t.chanel_id)>-1)}if(Object(Y.i)(n.support_help)){const e=i.support_help_id||0;n.support_help=this.chanels.filter(t=>t.chanel_id===e)[0]}if(Object(Y.i)(n.software)){const e=i.software_id||0,t=this.softwares.filter(t=>t.id===e);n.software=t.length>0?t[0]:void 0}if(Object(Y.i)(n.soft_name)&&(n.soft_name=i.soft_name),Object(Y.i)(n.ghelp)){const e=i.ghelp_id||0,t=this.ghelps.filter(t=>t.id===e);n.ghelp=t.length>0?t[0]:void 0}if(Object(Y.i)(n.product)){const e=i.product_id||0,t=this.products.filter(t=>t.extend_id===e);n.product=t.length>0?t[0]:void 0}let o=n[this.OD_KEYS.cate];if(Object(Y.h)(o)||Object(Y.h)(o.wk_team)){let e=i.od_category_id||0,t=(this.shared.catalogs.od_category||this.odCateItems).filter(t=>t.id===e);n[this.OD_KEYS.cate]=t.length>0?t[0]:void 0}if(Object(Y.h)(n[this.OD_KEYS.team])){let e=i.od_team_id||0,t=this.odWkTeamItems.filter(t=>t.id===e);n[this.OD_KEYS.team]=t.length>0?t[0]:void 0}if(Object(Y.h)(n[this.OD_KEYS.assign])){let e=i.od_assign_id||0,t=this.odAssignItems.filter(t=>t.id===e);n[this.OD_KEYS.assign]=t.length>0?t[0]:void 0}if(Object(Y.i)(n[this.OD_KEYS.topic])){let e=i.od_topic_id||0,t=this.odTopicItems.filter(t=>t.id===e);n[this.OD_KEYS.topic]=t.length>0?t[0]:void 0}return{user:t,full_name:t.name,user_id:t.id,user_code:t.token,od_khid:0,chanels:this._userCache.chanels||[],support_help:this._userCache.support_help,software:this._userCache.software||null,soft_name:this._userCache.soft_name,product:this._userCache.product,group_help:this._userCache.ghelp||null,od_team:this._userCache[this.OD_KEYS.team]||null,od_category:this._userCache[this.OD_KEYS.cate]||null,od_topic:this._userCache[this.OD_KEYS.topic]||null,od_assign:this._userCache[this.OD_KEYS.assign]||null,ticket_on:new s.d("en-US").transform(new Date,"yyMMdd"),reception_time:new s.d("en-US").transform(new Date,"yyyyMMdd-HH:mm"),complete_time:new s.d("en-US").transform(new Date,"yyyyMMdd-HH:")}}get disabledAction(){return this.isSaveTicket||this.isAsyncCatalog||this.isInitPage||this.isUpdateUser}convertObjToColDefs(e,t){return e.map(e=>({colId:e,field:e,headerName:t[e]||e}))}onFindPartner(){let e=this.formValue;this.nzModal.create({nzTitle:"T\xecm ki\u1ebfm kh\xe1ch h\xe0ng",nzClosable:!1,nzWidth:900,nzMaskClosable:!1,nzFooter:null,nzContent:Be,nzComponentParams:{fieldSearch:[],valueSearch:{vat:e.tax_code,phone:e.phone,email:e.email,customer_name:e.customer_name}}}).afterClose.pipe(Object(b.a)(e=>{if(e&&!Object(Y.i)(e.item)){let t=e.item;this.updateFValue("tax_code",t.vat),this.updateFValue("email",t.email),this.updateFValue("customer_name",t.display_name),this.updateFValue("company_name",t.comp_name),this.updateFValue("od_khid",t.id),this.updateFValue("od_partner",t);let i=this.formValue.phone;if(Object(Y.l)(i)){let e=t.mobile||t.phone;"false"===e&&(e=void 0),this.updateFValue("phone",e)}this.autoFixTicket(),!0===e.autoUpdate&&this.onSaveTicket()}return Object(ce.b)()})).subscribe()}ngSelectChange(e){this.logger.log(e)}onUpdateApiKey(){this.nzModal.create({nzTitle:"C\u1eadp nh\u1eadt m\xe3 k\xedch ho\u1ea1t",nzClosable:!1,nzContent:He,nzMaskClosable:!1,nzOkText:"L\u1ea5y m\xe3 k\xedch ho\u1ea1t",nzCancelText:"\u0110\xf3ng",nzFooter:null}).afterClose.subscribe(e=>{Object(Y.i)(e)||Object(Y.h)(e.data)||(this.shared.alert.success("\u0110\xe3 l\u1ea5y xong m\xe3 k\xedch ho\u1ea1t."),this.isInitPage=!0,this.onLoadCatalog())})}onTest(){this.odoo.ticket.getNoteDetail(143389).subscribe(e=>this.logger.log(e),e=>this.logger.warn(e))}}return e.\u0275fac=function(t){return new(t||e)(a.Nb(n.a),a.Nb(N.c),a.Nb(o.e),a.Nb(K.a),a.Nb(q.a),a.Nb(Oe),a.Nb(G.a),a.Nb(r.b))},e.\u0275cmp=a.Hb({type:e,selectors:[["t2t-ticket-form"]],viewQuery:function(e,t){var i;1&e&&(a.xc(Ye,!0),a.xc(We,!0),a.xc($e,!0)),2&e&&(a.qc(i=a.bc())&&(t.cChanels=i.first),a.qc(i=a.bc())&&(t.cProduct=i.first),a.qc(i=a.bc())&&(t.ngSlSupportHelp=i.first))},inputs:{isCreateNew:"isCreateNew",isInitPage:"isInitPage",userCfigModalRef:"userCfigModalRef",isViewSetDefault:"isViewSetDefault",inputUserCfigObj:"inputUserCfigObj",acceptEditPartner:"acceptEditPartner",isViewTicket:"isViewTicket",isAutoLoadCate:"isAutoLoadCate",ticket:"ticket"},outputs:{save:"save",remove:"remove",asyncInput:"asyncInput",isInitPageChange:"isInitPageChange",handlerLoadCate:"handlerLoadCate"},features:[a.xb],decls:51,vars:29,consts:[[1,"ticket-form",3,"formGroup","ngSubmit"],[1,"card"],[1,"card-body"],[1,"row"],[1,"col-xg-6","col-md-7","col-lr","col-body"],["class","col-md-3",4,"ngIf"],["class","col-md-6",4,"ngIf"],[1,"col-md-12"],[1,"form-group"],[1,""],[1,"required"],["bindLabel","value","formControlName","chanels",1,"required","chanel",3,"items","multiple","hideSelected","virtualScroll","closeOnSelect"],[1,"col-md-6"],["for","software",1,""],["bindLabel","value","formControlName","software",1,"required",3,"items","virtualScroll"],["for","group_help",1,""],["id","groupHelp","bindLabel","title","formControlName","group_help",1,"required",3,"items","virtualScroll"],[1,"col-12"],["class","col-12 col-od",4,"ngIf"],["class","col-12",4,"ngIf"],["class","col-md-7",4,"ngIf"],["class","col-md-5",4,"ngIf"],["class","col-xg-6 col-md-5 col-lr",4,"ngIf"],["class","row tool row-footer",4,"ngIf"],[1,"col-md-3"],["for","ticketOn"],["nz-input","","id","ticketOn","formControlName","ticket_on","required","",1,"note"],["for","ticketNumber"],["nz-input","","type","number","id","ticketNumber","formControlName","ticket_number"],["for","full_name"],["nz-input","","id","full_name","formControlName","full_name","required","",1,"note"],[1,"col-12","col-od"],["for","od_wk_team",1,""],["id","od_wk_team","bindLabel","display_name","formControlName","od_team",1,"required1",3,"items","virtualScroll","loading","search"],["for","od_assign_users",1,""],["id","od_assign_users","bindLabel","display_name","formControlName","od_assign",1,"required1",3,"items","virtualScroll","loading","search"],["for","od_helpdesk_category",1,""],["id","od_helpdesk_category","bindLabel","name","formControlName","od_category",3,"virtualScroll","items","change","search"],["for","od_helpdesk_topic",1,""],["id","od_helpdesk_topic","bindLabel","display_name","formControlName","od_topic",3,"virtualScroll","items","search"],[1,"col-md-7"],[1,"partner-group","d-flex","align-item-center"],["for","taxCode",1,"mr-4"],["nz-input","","id","taxCode","formControlName","tax_code","required",""],["nz-input","","id","image_name","formControlName","image_name","placeholder","1;2(*.png)",1,"partner_id","ml-1"],[1,"col-md-5"],["for","customerName"],["nz-input","","id","customerName","formControlName","customer_name"],["nz-input","","id","email","formControlName","email","required",""],["nz-input","","id","od_khid","placeholder","KH_ID","formControlName","od_khid",1,"partner_id","ml-1","border-warning",3,"ngModelChange"],["for","phone"],["nz-input","","id","phone","formControlName","phone"],[1,"row","d-flex","ml-n1"],[1,"col-7"],["for","content_required"],["nz-input","","id","content_required","formControlName","content_required"],[1,"col-5"],["for","reception_time"],["nz-input","","id","reception_time","formControlName","reception_time"],["for","teamviewer"],["nz-input","","id","teamviewer","formControlName","teamviewer"],["for","content_help"],["nz-input","","id","content_help","formControlName","content_help"],["for","complete_time"],["nz-input","","id","complete_time","formControlName","complete_time"],["for","help",1,""],["bindLabel","title","formControlName","help",3,"items","change"],["for","support_help",1,""],["bindLabel","value","formControlName","support_help",3,"items","virtualScroll"],["ngSlSupportHelp",""],["for","soft_names",1,""],["formControlName","soft_name",1,"required1",3,"items","virtualScroll"],["for","companyName"],["nz-input","","id","companyName","formControlName","company_name"],["for","productId",1,""],["bindLabel","name","formControlName","product",3,"items","virtualScroll"],["cProduct",""],[1,"col-xg-6","col-md-5","col-lr"],["class","col-md-12",4,"ngIf"],[1,"row",2,"margin-left","-12px"],["nz-checkbox","",1,"show-column",3,"ngModel","ngModelOptions","ngModelChange","click"],["nz-checkbox","",1,"show-column",3,"ngModel","ngModelOptions","ngModelChange"],["for","content_copy"],["nz-input","","nzAutosize","","id","content_copy","formControlName","content_copy"],["for","subject"],["nz-input","","id","subject","rows","1","formControlName","subject"],["for","body"],["nz-input","","nzAutosize","","id","body","formControlName","body"],["for","note"],["nz-input","","nzAutosize","","id","note","formControlName","note"],[1,"row","tool","row-footer"],[1,"col-12","d-flex"],["nz-button","","nzType","primary","type","submit",3,"disabled",4,"ngIf"],["nz-button","","nzType","default","type","button",3,"disabled","click",4,"ngIf"],["nz-button","","nzType","default","type","button",3,"disabled","click"],["nz-icon","","nzType","check"],["nz-icon","","nzType","redo",4,"ngIf"],["nz-icon","",3,"nzType","nzSpin",4,"ngIf"],["nz-dropdown","","nz-button","","type","button",3,"disabled","nzDropdownMenu"],["nz-icon","","nzType","solution"],["nzMenuOther",""],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-menu-item","",3,"click"],["nz-icon","","nzType","copy"],["nz-button","","nzDanger","","type","button",3,"disabled","click",4,"ngIf"],["nz-button","","nzType","primary","type","submit",3,"disabled"],["nz-icon","","nzType","save",4,"ngIf"],["nz-icon","",3,"nzType","nzSpin"],["nz-icon","","nzType","save"],["nz-icon","","nzType","delete"],["nz-icon","","nzType","redo"],["nz-icon","","nzType","plus"],[1,"fal","fa-search"],["nz-button","","nzDanger","","type","button",3,"disabled","click"],["nz-icon","","nzType","user"]],template:function(e,t){1&e&&(a.Tb(0,"form",0),a.ac("ngSubmit",(function(){return t.onSaveTicket()})),a.Tb(1,"div",1),a.Tb(2,"div",2),a.Tb(3,"div",3),a.Tb(4,"div",4),a.Tb(5,"div",3),a.Bc(6,Xe,8,0,"div",5),a.Bc(7,Qe,5,0,"div",5),a.Bc(8,Je,8,0,"div",6),a.Tb(9,"div",7),a.Tb(10,"div",8),a.Tb(11,"label",9),a.Dc(12,"K\xeanh - T\xecnh tr\u1ea1ng "),a.Tb(13,"span",10),a.Dc(14,"(*)"),a.Sb(),a.Dc(15,":"),a.Sb(),a.Ob(16,"ng-select",11),a.Sb(),a.Sb(),a.Tb(17,"div",12),a.Tb(18,"div",8),a.Tb(19,"label",13),a.Dc(20,"Nh\xf3m Ph\u1ea7n m\u1ec1m "),a.Tb(21,"span",10),a.Dc(22,"(*)"),a.Sb(),a.Dc(23,": "),a.Sb(),a.Ob(24,"ng-select",14),a.Sb(),a.Sb(),a.Tb(25,"div",12),a.Tb(26,"div",8),a.Tb(27,"label",15),a.Dc(28,"Nh\xf3m h\u1ed7 tr\u1ee3 "),a.Tb(29,"span",10),a.Dc(30,"(*)"),a.Sb(),a.Dc(31,":"),a.Sb(),a.Ob(32,"ng-select",16),a.Sb(),a.Sb(),a.Tb(33,"div",17),a.Dc(34,"-------"),a.Sb(),a.Bc(35,Ze,34,10,"div",18),a.Bc(36,et,2,0,"div",19),a.Bc(37,tt,11,0,"div",20),a.Bc(38,it,5,0,"div",21),a.Bc(39,nt,10,0,"div",20),a.Bc(40,ot,5,0,"div",21),a.Bc(41,st,18,0,"div",20),a.Bc(42,ct,5,0,"div",21),a.Bc(43,rt,18,0,"div",20),a.Bc(44,at,5,1,"div",21),a.Bc(45,lt,9,2,"div",6),a.Bc(46,dt,8,2,"div",6),a.Bc(47,bt,5,0,"div",6),a.Bc(48,ht,6,2,"div",6),a.Sb(),a.Sb(),a.Bc(49,Tt,21,25,"div",22),a.Sb(),a.Bc(50,Ft,29,15,"div",23),a.Sb(),a.Sb(),a.Sb()),2&e&&(a.jc("formGroup",t.ticketForm),a.zb(6),a.jc("ngIf",t.isViewAll&&!t.isViewSetDefault),a.zb(1),a.jc("ngIf",t.isViewAll&&!t.isViewSetDefault),a.zb(1),a.jc("ngIf",t.isViewAll&&!t.isViewSetDefault),a.zb(8),a.jc("items",t.chanels)("multiple",!0)("hideSelected",!0)("virtualScroll",!0)("closeOnSelect",!1),a.zb(8),a.jc("items",t.softwares)("virtualScroll",!0),a.zb(8),a.jc("items",t.ghelps)("virtualScroll",!0),a.zb(3),a.jc("ngIf",t.isViewColOdoo||t.isViewSetDefault),a.zb(1),a.jc("ngIf",t.isViewColOdoo),a.zb(1),a.jc("ngIf",!t.isViewSetDefault),a.zb(1),a.jc("ngIf",!t.isViewSetDefault),a.zb(1),a.jc("ngIf",!t.isViewSetDefault),a.zb(1),a.jc("ngIf",!t.isViewSetDefault),a.zb(1),a.jc("ngIf",!t.isViewSetDefault),a.zb(1),a.jc("ngIf",!t.isViewSetDefault),a.zb(1),a.jc("ngIf",!t.isViewSetDefault),a.zb(1),a.jc("ngIf",!t.isViewSetDefault),a.zb(1),a.jc("ngIf",t.isViewAll||t.isViewSetDefault),a.zb(1),a.jc("ngIf",t.isViewAll&&!t.isViewSetDefault),a.zb(1),a.jc("ngIf",!1),a.zb(1),a.jc("ngIf",!1),a.zb(1),a.jc("ngIf",!t.isViewSetDefault),a.zb(1),a.jc("ngIf",!t.isViewSetDefault))},directives:[o.t,o.m,o.h,s.n,r.a,o.l,o.g,y.b,o.d,o.r,o.p,y.c,T.a,D.a,o.o,y.a,v.a,je.a,O.a,A.a,A.c,A.d,j.c,j.d],styles:[".ticket-form [nz-button]{margin-right:5px}.ticket-form .card{margin-top:10px;padding:0 10px;border-radius:2px}.ticket-form .card .row.tool{margin-top:10px}.ticket-form .card .row.tool .show-column{padding-top:5px}.col-od .row{margin:auto 0}.ng-select.chanel .ng-select-container{height:40px!important;min-height:40px!important}.ng-select-container{height:27px!important;min-height:27px!important}.user-config .card{padding-bottom:0;margin-top:-10px;margin-bottom:0;border:unset}.user-config .col-body{max-width:100%;flex:0 0 100%}.user-config .row.tool{border-top:2px solid #2f54eb;padding-top:10px;padding-bottom:5px}.user-config .ant-modal-body{padding-bottom:0}.ng-select.ng-select-single .ng-select-container .ng-value-container .ng-input{top:3px;padding-left:3px}.partner-group .partner_id{width:120px;font-weight:700}.partner-group .chk_image{color:var(--danger)}.partner-group .img_group{max-width:155px;font-weight:700;top:0}.partner-group .img_group .img_id:focus,.partner-group .img_group .img_id:hover{z-index:unset}.partner-group .img_group .ant-input-group-addon{border:1px solid var(--warning);padding:unset}.partner-group .img_group label{height:unset;margin-right:unset;margin-bottom:unset}.ag-grid2 a{color:var(--blue)!important}.ag-grid2 .fa-check{font-size:1.3rem;color:var(--blue)}.ag-grid2 .fa-exclamation-circle{font-size:1.3rem;color:var(--red);padding-top:3px}"],encapsulation:2}),e})();i("KLQV");var Nt=i("4e/d"),Mt=i("UbAx"),Rt=i("evcz"),Bt=i("47ST");let Ut=(()=>{class e{constructor(e,t,i){this.userSys=e,this.odoo=t,this.ticket=i}NOTICKET(e,t){return Object(Bt.a)({code:"NO_TICKET",message:`<b>${t}</b> > <b>Ticket ch\u01b0a \u0111\u01b0\u1ee3c t\u1ea1o</b>.`})}ERR_SRV(e){return Object(Bt.a)({message:"X\u1ea3y ra l\u1ed7i c\u1eadp nh\u1eadt th\xf4ng tin ticket l\xean m\xe1y ch\u1ee7.",code:"ERR_SRV",detail:e})}checkValidTicket(e,t){let i=(t=t||["partner","od_team","od_category","od_assign"]).filter(t=>Y.f.jsonEmpty(e[t]));return 0===i.length?void 0:{code:"ERR_DATA",message:"X\u1ea3y ra l\u1ed7i > D\u1eef li\u1ec7u ch\u01b0a \u0111\xfang \u1edf field "+i.join("|"),detail:i}}createTicket(e){return this.odoo.ticket.newTicket(e)}updateTicket(e){return this.odoo.ticket.updateTicket(e)}addNote(e){return this.odoo.ticket.addNote(e)}uploadFile(e,t){}updateStage(e,t){let i=e.ticket_id;return Object(Y.i)(t)||Object(Y.l)(t.id)?Object(Bt.a)({code:"NO_STAGE",message:`[${i}] Kh\xf4ng x\xe1c \u0111\u1ecbnh \u0111\u01b0\u1ee3c [tr\u1ea1ng th\xe1i]`}):this.odoo.ticket.closeTicket(i)}allInOne(e,t,i){i=Object.assign({alert:!1},i),e=Object(Y.l)(e)||"all"===e?null:e;let n=Object(Y.l)(e)?["create_ticket","add_note","add_note_with_img","close_ticket"]:e.split(",");return this.odoo.ticket.createAll(t,n.join(","),i)}}return e.\u0275fac=function(t){return new(t||e)(a.Xb(G.a),a.Xb(Oe),a.Xb(q.a))},e.\u0275prov=a.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Lt=i("cHbk");let Et=(()=>{class e{constructor(e,t,i,n){this.modal=e,this.shared=t,this.gridField=i,this.fb=n,this.data={},this.count=0}ngOnInit(){this.form=this.fb.group({grid_type:[{value:this.data.grid_type,disabled:!0},o.s.required],grid_code:[this.data.grid_code,o.s.required],grid_title:[this.data.grid_title,o.s.required]})}onSave(){if(this.form.invalid)return void this.shared.alert.warning("Vui l\xf2ng nh\u1eadp \u0111\u1ea7y \u0111\u1ee7 th\xf4ng tin.");let e=this.form.getRawValue();this.gridField.createOrUpdate({grid_type:e.grid_type,grid_code:e.grid_code,grid_title:e.grid_title,index:this.data.index||this.count+1,grid_fields:this.data.columns.map((e,t)=>((e,t)=>({[t.getColId()]:{index:e,width:t.getActualWidth()}}))(t,e)).reduce((e,t)=>Object.assign(Object.assign({},e),t),{})}).subscribe(e=>{this.shared.alert.success("L\u01b0u m\u1eabu th\xe0nh c\xf4ng."),this.modal.destroy(e)})}}return e.\u0275fac=function(t){return new(t||e)(a.Nb(N.b),a.Nb(K.a),a.Nb(Rt.a),a.Nb(o.e))},e.\u0275cmp=a.Hb({type:e,selectors:[["cy-ag-template"]],decls:30,vars:1,consts:[[1,"create-ag-form",3,"formGroup","ngSubmit"],[1,"card"],[1,"card-body"],[1,"row"],[1,"form-group","col-12"],["for","grid_type"],[1,"required"],["nz-input","","id","grid_type","formControlName","grid_type","required",""],["for","grid_code"],["nz-input","","id","grid_code","formControlName","grid_code","required",""],["for","grid_title"],["nz-input","","id","grid_title","formControlName","grid_title","required",""],[1,"row","mt-2"],["nz-button","","nzType","default"],["nz-icon","","nzType","plus"]],template:function(e,t){1&e&&(a.Tb(0,"form",0),a.ac("ngSubmit",(function(){return t.onSave()})),a.Tb(1,"div",1),a.Tb(2,"div",2),a.Tb(3,"div",3),a.Tb(4,"div",4),a.Tb(5,"label",5),a.Dc(6,"Lo\u1ea1i AgGrid: "),a.Tb(7,"span",6),a.Dc(8,"(*)"),a.Sb(),a.Dc(9,": "),a.Sb(),a.Ob(10,"input",7),a.Sb(),a.Tb(11,"div",4),a.Tb(12,"label",8),a.Dc(13,"M\xe3 m\u1eabu: "),a.Tb(14,"span",6),a.Dc(15,"(*)"),a.Sb(),a.Dc(16,": "),a.Sb(),a.Ob(17,"input",9),a.Sb(),a.Tb(18,"div",4),a.Tb(19,"label",10),a.Dc(20,"T\xean m\u1eabu: "),a.Tb(21,"span",6),a.Dc(22,"(*)"),a.Sb(),a.Dc(23,": "),a.Sb(),a.Ob(24,"input",11),a.Sb(),a.Sb(),a.Tb(25,"div",12),a.Tb(26,"div",4),a.Tb(27,"button",13),a.Ob(28,"i",14),a.Dc(29,"L\u01b0u l\u1ea1i "),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb()),2&e&&a.jc("formGroup",t.form)},directives:[o.t,o.m,o.h,y.b,o.d,o.l,o.g,o.r,v.a,je.a,T.a,O.a],styles:[".create-ag-form .row{margin:auto -15px}"],encapsulation:2}),e})();var Gt=i("J50X"),Kt=i("Mr8s");const qt=["agrid"],Ht=["ticketForm"],Pt=["importExcelRef"],Yt=["linkDown"];function Wt(e,t){1&e&&a.Ob(0,"i",31),2&e&&a.jc("nzType","sync")("nzSpin",!0)}function $t(e,t){1&e&&a.Ob(0,"i",32)}function Xt(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",21),a.ac("click",(function(){a.sc(e);const i=t.$implicit;return a.dc(2).onAgGridFilter(i.key)})),a.Tb(1,"a"),a.Dc(2),a.Sb(),a.Sb()}if(2&e){const e=t.index,i=t.$implicit;a.zb(2),a.Gc("",e+1,". ",i.title,"")}}function Qt(e,t){if(1&e&&(a.Tb(0,"nz-form-item"),a.Tb(1,"nz-form-control"),a.Tb(2,"button",14),a.Dc(3,"L\u1ecdc"),a.Ob(4,"i",33),a.Sb(),a.Tb(5,"nz-dropdown-menu",null,34),a.Tb(7,"ul",17),a.Bc(8,Xt,3,2,"ng-template",35),a.Sb(),a.Sb(),a.Sb(),a.Sb()),2&e){const e=a.rc(6),t=a.dc();a.zb(2),a.jc("nzTrigger","click")("nzDropdownMenu",e)("disabled",t.disabledAction),a.zb(6),a.jc("ngForOf",t.allFilterObj)("ngForTrackBy",t.allFilterObjTrackByKey)}}function Jt(e,t){1&e&&a.Ob(0,"i",38)}function Zt(e,t){1&e&&a.Ob(0,"i",31),2&e&&a.jc("nzType","sync")("nzSpin",!0)}function ei(e,t){if(1&e){const e=a.Ub();a.Rb(0),a.Tb(1,"button",14),a.Bc(2,Jt,1,0,"i",36),a.Bc(3,Zt,1,2,"i",11),a.Tb(4,"span"),a.Dc(5,"G\u1eedi Ticket"),a.Sb(),a.Sb(),a.Tb(6,"nz-dropdown-menu",null,37),a.Tb(8,"ul",17),a.Tb(9,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onSendHelpdesk("all")})),a.Tb(10,"a"),a.Dc(11,"1. G\u1eedi 3 b\u01b0\u1edbc"),a.Sb(),a.Sb(),a.Tb(12,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onSendHelpdesk("create_ticket")})),a.Tb(13,"a"),a.Dc(14,"2. G\u1eedi Ticket"),a.Sb(),a.Sb(),a.Tb(15,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onSendHelpdesk("add_note")})),a.Tb(16,"a"),a.Dc(17,"3. G\u1eedi note"),a.Sb(),a.Sb(),a.Tb(18,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onSendHelpdesk("add_note_with_img")})),a.Tb(19,"a"),a.Dc(20,"4. \u0110\xednh k\xe8m h\xecnh"),a.Sb(),a.Sb(),a.Tb(21,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onSendHelpdesk("close_ticket")})),a.Tb(22,"a"),a.Dc(23,"5. Theo d\xf5i + \u0110\xf3ng"),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Qb()}if(2&e){const e=a.rc(7),t=a.dc();a.zb(1),a.jc("nzTrigger","click")("nzDropdownMenu",e)("disabled",t.disabledAction),a.zb(1),a.jc("ngIf",!t.isSendTicket),a.zb(1),a.jc("ngIf",t.isSendTicket)}}function ti(e,t){1&e&&a.Ob(0,"i",44)}function ii(e,t){1&e&&a.Ob(0,"i",31),2&e&&a.jc("nzType","sync")("nzSpin",!0)}function ni(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",21),a.ac("click",(function(){return a.sc(e),a.dc(2).onImportXlsx()})),a.Tb(1,"a"),a.Ob(2,"i",45),a.Dc(3,"N\u1ea1p d\u1eef li\u1ec7u"),a.Sb(),a.Sb()}}function oi(e,t){if(1&e){const e=a.Ub();a.Rb(0),a.Tb(1,"button",39),a.Bc(2,ti,1,0,"i",40),a.Bc(3,ii,1,2,"i",11),a.Tb(4,"span"),a.Dc(5,"N\u1ea1p / Xu\u1ea5t DL"),a.Sb(),a.Sb(),a.Tb(6,"nz-dropdown-menu",null,41),a.Tb(8,"ul",17),a.Bc(9,ni,4,0,"li",18),a.Tb(10,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onExportXlsx()})),a.Tb(11,"a"),a.Ob(12,"i",42),a.Dc(13,"Xu\u1ea5t d\u1eef li\u1ec7u"),a.Sb(),a.Sb(),a.Tb(14,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onExportExcelMau()})),a.Tb(15,"a"),a.Ob(16,"i",43),a.Dc(17,"File m\u1eabu"),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Qb()}if(2&e){const e=a.rc(7),t=a.dc();a.zb(1),a.jc("nzDropdownMenu",e)("disabled",t.disabledAction),a.zb(1),a.jc("ngIf",!t.isRunImport),a.zb(1),a.jc("ngIf",t.isRunImport),a.zb(6),a.jc("ngIf",t.isRole("timport_xsl"))}}function si(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",21),a.ac("click",(function(){a.sc(e);const i=t.$implicit;return a.dc(2).showCustomColumnAgGrid(i)})),a.Tb(1,"a"),a.Dc(2),a.Sb(),a.Sb()}if(2&e){const e=t.$implicit,i=t.index;a.zb(2),a.Gc("",i+2,". ",e.grid_title,"")}}function ci(e,t){if(1&e){const e=a.Ub();a.Rb(0),a.Tb(1,"button",46),a.Ob(2,"i",47),a.Dc(3,"Danh s\xe1ch m\u1eabu "),a.Sb(),a.Tb(4,"nz-dropdown-menu",null,48),a.Tb(6,"ul",49),a.Tb(7,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().showColumnAgGrid("ALL")})),a.Tb(8,"a"),a.Dc(9,"1. Hi\u1ec3n th\u1ecb ALL"),a.Sb(),a.Sb(),a.Bc(10,si,3,2,"ng-template",35),a.Tb(11,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().clickCopyAllRowToClipboard()})),a.Tb(12,"a"),a.Dc(13),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Qb()}if(2&e){const e=a.rc(5),t=a.dc();a.zb(1),a.jc("nzDropdownMenu",e)("nzTrigger","click")("disabled",t.disabledAction),a.zb(9),a.jc("ngForOf",t.allGridField)("ngForTrackBy",t.trackByAg),a.zb(3),a.Fc("",t.allGridField.length+2,". Sao ch\xe9p")}}function ri(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onDeleteMultiTicket()})),a.Ob(1,"i",22),a.Dc(2,"X\xf3a Ticket "),a.Sb()}}function ai(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onAutoFixTicket()})),a.Ob(1,"i",50),a.Dc(2,"T\u1ef1 \u0111\u1ed9ng s\u1eeda "),a.Sb()}}function li(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().createAgGridTemplate()})),a.Ob(1,"i",51),a.Dc(2,"T\u1ea1o/C\u1eadp nh\u1eadt m\u1eabu "),a.Sb()}}function di(e,t){if(1&e){const e=a.Ub();a.Tb(0,"li",21),a.ac("click",(function(){return a.sc(e),a.dc().onSendReport()})),a.Ob(1,"i",51),a.Dc(2,"G\u1eedi b\xe1o c\xe1o "),a.Sb()}}const bi=function(){return["/admin"]};function hi(e,t){1&e&&(a.Tb(0,"li",52),a.Tb(1,"a"),a.Ob(2,"i",53),a.Dc(3,"C\u1ea5u h\xecnh"),a.Sb(),a.Sb()),2&e&&a.jc("routerLink",a.lc(1,bi))}function ui(e,t){if(1&e&&(a.Tb(0,"span"),a.Tb(1,"span",27),a.Dc(2," - "),a.Sb(),a.Tb(3,"span",28),a.Dc(4),a.Sb(),a.Sb()),2&e){const e=a.dc();a.zb(4),a.Fc("C=",e.data.length," ")}}function pi(e,t){if(1&e&&(a.Tb(0,"div"),a.Ob(1,"nz-divider",56),a.Tb(2,"nz-upload",58),a.Tb(3,"a",59),a.Dc(4),a.Sb(),a.Sb(),a.Sb()),2&e){const e=a.dc(2);a.zb(2),a.jc("nzBeforeUpload",e.beforeUploadDir),a.zb(2),a.Ec(e.lblPathDir)}}function gi(e,t){if(1&e&&(a.Tb(0,"label"),a.Tb(1,"span",64),a.Dc(2),a.Sb(),a.Tb(3,"span",65),a.Dc(4,"Running =>"),a.Sb(),a.Sb()),2&e){const e=a.dc(3);a.zb(2),a.Fc("[",null==e.msgObj?null:e.msgObj.action,"] ")}}function mi(e,t){if(1&e&&(a.Rb(0),a.Ob(1,"nz-divider",56),a.Tb(2,"nz-input-group",60),a.Bc(3,gi,5,1,"label",13),a.Tb(4,"label"),a.Dc(5,"Oki"),a.Tb(6,"span",61),a.Dc(7),a.Sb(),a.Tb(8,"i"),a.Dc(9,"+"),a.Sb(),a.Sb(),a.Tb(10,"label"),a.Dc(11,"Err"),a.Tb(12,"span",62),a.Dc(13),a.Sb(),a.Tb(14,"i"),a.Dc(15,"="),a.Sb(),a.Sb(),a.Tb(16,"label"),a.Dc(17,"TS"),a.Tb(18,"span",63),a.Dc(19),a.Sb(),a.Sb(),a.Sb(),a.Qb()),2&e){const e=a.dc(2);a.zb(3),a.jc("ngIf",e.isSendTicket),a.zb(4),a.Fc("[",(null==e.msgObj?null:e.msgObj.ok)||0,"]"),a.zb(6),a.Fc("[",(null==e.msgObj?null:e.msgObj.err)||0,"]"),a.zb(6),a.Fc("[",(null==e.msgObj?null:e.msgObj.total)||e.totalSelect,"]")}}function fi(e,t){if(1&e){const e=a.Ub();a.Tb(0,"div"),a.Ob(1,"nz-divider",56),a.Tb(2,"a",66),a.ac("click",(function(){return a.sc(e),a.dc(2).stopSendTicket()})),a.Tb(3,"span"),a.Dc(4,"D\u1eebng l\u1ea1i"),a.Sb(),a.Sb(),a.Sb()}}function Ti(e,t){if(1&e){const e=a.Ub();a.Rb(0),a.Tb(1,"div",54),a.Tb(2,"div",55),a.Ob(3,"nz-divider",56),a.Tb(4,"label",57),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().isStopTicketIfError=t})),a.Dc(5,"G\u1eb7p l\u1ed7i > D\u1eebng"),a.Sb(),a.Ob(6,"nz-divider",56),a.Tb(7,"label",57),a.ac("ngModelChange",(function(t){return a.sc(e),a.dc().isUpdateIfTicketExist=t})),a.Dc(8,"T\u1ea1o m\u1edbi + c\u1eadp nh\u1eadt"),a.Sb(),a.Bc(9,pi,5,2,"div",13),a.Bc(10,mi,20,4,"ng-container",13),a.Bc(11,fi,5,0,"div",13),a.Sb(),a.Sb(),a.Qb()}if(2&e){const e=a.dc();a.zb(4),a.jc("ngModel",e.isStopTicketIfError),a.zb(3),a.jc("ngModel",e.isUpdateIfTicketExist),a.zb(2),a.jc("ngIf",e.isViewUploadDir),a.zb(1),a.jc("ngIf",e.totalSelect>0||!!e.msgObj),a.zb(1),a.jc("ngIf",e.isSendTicket)}}const ki=function(){return["ls_filter"]},_i=function(){return["excel"]},Si=function(){return["report"]};let Oi=(()=>{class e{constructor(e,t,i,n,o,s,c,r,a,l,b){this.gridField=e,this.cd=t,this.fb=i,this.ticketCtrl=n,this.excelCtrl=o,this.router=s,this.aRouter=c,this.cfigCtrl=r,this.shared=a,this.userCtrl=l,this.helpdesk=b,this.data=[],this.dataCache=[],this.msgObj={title:"K\u1ebft qu\u1ea3",total:0,ok:0,err:0,action:""},this.allImageUpload={},this.lblPathDir_=void 0,this.isViewUploadDir_=!1,this.agAllModule=Lt.a,this.gridOptions=this.createAgOption(),this.gridApi=null,this.gridColumnApi=null,this.columnDefs=[],this.agFilterType="ALL",this.excelStyles=[{id:"header",interior:{color:"#CCCCCC",pattern:"Solid"},borders:{borderBottom:{color:"#5687f5",lineStyle:"Continuous",weight:1},borderLeft:{color:"#5687f5",lineStyle:"Continuous",weight:1},borderRight:{color:"#5687f5",lineStyle:"Continuous",weight:1},borderTop:{color:"#5687f5",lineStyle:"Continuous",weight:1}}}],this.showBtnUpdate=!1,this.isNew=!0,this.isSendTicket=!1,this.isLoadSearch=!1,this.isRunImport=!1,this.isDeleteStatus=!1,this.isClickShowColKpi=!1,this.isLoadWithChanel=!1,this.isHideFormCreate="block",this.isShowMsg=!1,this.isAutoLoadCate=!0,this.isUpdateIfTicketExist=!1,this.isStopTicketIfError=!1,this.fileImport=[],this.xlsxType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",this.agGridViewType=this.shared.getByKey("agGridViewType")||"DEFAULT",this.isViewSendHelpdesk=this.agGridViewType===Gt.e,this.fileList=[],this.isInitPage=!0,this.autoCreate=!1,this.editTicket=null,this.nodeTicket=null,this.asyncInput=!1,this.KEY_GRID_TYPE="ticket_list",this.lblGrid={total:0,with:"Ticket",view:"STT > Z-A",countTicket:0,countChanel:0},this.groupTemp=0,this.indexStyle=0,this.defaultColDef={enableValue:!0,enableRowGroup:!0,enablePivot:!0,sortable:!1,resizable:!0,suppressMenu:!0},this.allFilterObj=[{key:"all",title:"T\u1ea5t c\u1ea3"},{key:"is_send_ticket",title:"\u0110\xe3 g\u1eedi ticket"},{key:"is_send_note",title:"\u0110\xe3 \u0111\xecnh th\xeam note"},{key:"is_upfile",title:"\u0110\xe3 \u0111\xecnh k\xe8m h\xecnh"},{key:"is_close_ticket",title:"\u0110\xe3 \u0111\xf3ng ticket"},{key:"no_send_ticket",title:"Ch\u01b0a g\u1eedi ticket"},{key:"no_send_note",title:"Ch\u01b0a th\xeam note"},{key:"no_upfile",title:"Ch\u01b0a \u0111\xednh k\xe8m h\xecnh"},{key:"no_close_ticket",title:"Ch\u01b0a \u0111\xf3ng ticket"},{key:"is_report",title:"\u0110\xe3 g\u1eedi b\xe1o c\xe1o"},{key:"no_report",title:"Ch\u01b0a g\u1eedi b\xe1o c\xe1o"}],this.runSendTicket=void 0,this.agGridCustom={},this.beforeUploadDir=(e,t)=>(this.fileList=t,this.lblPathDir_=`(${t.length}) H\xecnh`,Y.b.getBase64(e).then(t=>Object(d.a)(this,void 0,void 0,(function*(){let i=e.name.toLowerCase();this.allImageUpload[i]=yield t}))),!1)}ngOnInit(){let e=this.shared.catalogs.isAutoLoadCate;this.isAutoLoadCate=!!Object(Y.i)(e)||e,this.userDetail=this.userCtrl.read(),this.gridField.getColumnAgFromCache(Gt.b).subscribe(e=>{this.agColumnFix=e.column_fix,this.columnDefs=this.agColumnFix.def}),this.isHideFormCreate=this.shared.getByKey("isHideFormCreate");let t=new Date,i=new Date;this.searchForm=this.fb.group({ticketOn:[[t,i]],withChanel:[!1],hideFormCreate:["none"===this.isHideFormCreate]}),this.searchForm.get("withChanel").valueChanges.subscribe(e=>{this.showTicketWithChanel(e)}),this.searchForm.get("hideFormCreate").valueChanges.subscribe(e=>{this.isHideFormCreate=e?"none":"block",this.shared.setByKey("isHideFormCreate",this.isHideFormCreate),e||(this.isViewSendHelpdesk=!1,this.disableWithChanel(!1),this.showCustomColumnAgGrid(this.allGridFieldMap[Gt.d]||{}))}),this.getRowClass=e=>"ag-grid-row-style-"+(0==e.node.rowIndex%2?0:1),this.initSearchFromQuery()}initSearchFromQuery(){this.aRouter.queryParamMap.subscribe(e=>{this.searchForm.get("ticketOn").setValue([Y.d.parseDate(e.get("from"),new Date),Y.d.parseDate(e.get("to"),new Date)])})}disableWithChanel(e){console.log(e);let t=this.searchForm.get("withChanel");e?(t.setValue(!e),t.disable()):t.enable()}get isViewToolSendTicket(){return this.agGridViewType===Gt.e}get lblPathDir(){return this.lblPathDir_||"Th\u01b0 m\u1ee5c h\xecnh"}get allGridFieldMap(){return this.userCtrl.read().getAgField(this.KEY_GRID_TYPE)||{}}get allGridField(){return Object.values(this.allGridFieldMap).sort((e,t)=>e.index-t.index)}get isViewUploadDir(){return this.isViewSendHelpdesk&&(this.isViewUploadDir_||this.totalSelect>0)}get countTicket(){return this.dataCache.length||0}get totalSelect(){return Object(Y.i)(this.gridApi)?0:this.gridApi.getSelectedRows().length}get disabledAction(){return this.isLoadSearch||this.isSendTicket||this.isRunImport}isRole(e){return this.userDetail.isRole(e)}ngAfterViewInit(){this.cd.detectChanges()}ngOnChanges(e){console.log(e)}trackByAg(e,t){return`${t.grid_code}:${t.grid_code}`}createAgOption(){return{rowSelection:"multiple",sideBar:!0,excelStyles:this.excelStyles,getRowClass:this.getRowClass,onRowClicked:e=>this.onRowClicked(e),isExternalFilterPresent:()=>this.agFilterPresent(),doesExternalFilterPass:e=>this.agFilterPass(e)}}agFilterPresent(){return"ALL"!==this.agFilterType}agFilterPass(e){let t=e.data;switch(this.agFilterType){case"is_send_ticket":return!Object(Y.l)(t.ticket_number);case"no_send_ticket":return Object(Y.l)(t.ticket_number);case"is_send_note":return!Object(Y.l)(t.note_id);case"no_send_note":return Object(Y.l)(t.note_id);case"is_close_ticket":return 3===t.status;case"no_close_ticket":return 3!==t.status;case"is_upfile":return Object(Y.m)(t.is_upfile);case"no_upfile":return!Object(Y.m)(t.is_upfile);case"is_report":return Object(Y.m)(t.is_greport);case"no_report":return!Object(Y.m)(t.is_greport);default:return!0}}allFilterObjTrackByKey(e,t){return t.key}onAgGridFilter(e){this.agFilterType=e,this.gridApi.onFilterChanged()}onGridReady(e){this.gridApi=e.api,this.gridColumnApi=e.columnApi,Ce.a.fixColDef(this.userDetail,this.gridApi),this.showCustomColumnAgGrid(this.allGridFieldMap.ag_default)}defIfNull(e,t){return Object(Y.i)(e)?null:t}onSaveTicket(e,t=this.nodeTicket){if(e.isNew&&Object(Y.i)(e.ticket))return;const i=(e=Object.assign({isRefresh:!0},e)).ticket;Object(ne.a)("").pipe(Object(ie.a)(n=>{if(Object(Y.i)(t)||e.isNew){let e=this.gridApi.applyTransaction({add:[i]});this.nodeTicket=e.add[0],this.editTicket=i,this.dataCache.push(i),this.refreshRow(t=this.nodeTicket)}else Object(Y.i)(t)||this.refreshRow(t,i)})).subscribe(()=>{})}clickCopyAllRowToClipboard(){let e=!1;0==this.gridApi.getSelectedRows().length>0&&(this.gridApi.selectAll(),e=!0),this.gridApi.copySelectedRowsToClipboard(!1),e&&this.gridApi.deselectAll(),this.shared.alert.success("\u0110\xe3 sao ch\xe9p xong, gi\u1edd v\xe0o excel \u0111\u1ec3 d\xe1n (Ctrl + V).")}isSelectRow(){return this.gridApi.getSelectedRows().length>0}clickNewTicket(){this.isNew=!0,this.editTicket=void 0}onDeleteMultiTicket(){let e=this.gridApi.getSelectedNodes();0!==e.length?(this.isShowMsg=!0,this.msgObj={title:"X\xf3a d\u1eef li\u1ec7u",total:e.length,ok:0,err:0},this.shared.modal.warning({nzTitle:"C\u1ea3nh b\xe1o !!",nzClosable:!1,nzOkText:"X\xf3a",nzCancelText:"\u0110\xf3ng",nzContent:`B\u1ea1n c\xf3 mu\u1ed1n x\xf3a ${e.length} d\xf2ng \u0111\xe3 ch\u1ecdn?`,nzOnOk:()=>{let t=this.shared.loading("\u0110ang x\xf3a d\u1eef li\u1ec7u"),i=Object(ne.a)(...e).pipe(Object(Z.a)(e=>Object(ne.a)(e).pipe(Object(ee.a)(1e3)))).pipe(Object(b.a)(e=>(this.ticketCtrl.deleteOne(e.data.ticket_id).subscribe(),Object(ne.a)(e)))).subscribe(e=>{this.msgObj.ok++,this.onRemoveNode(e),this.shared.alert.success(`[${e.data.ticket_id}] \u0110\xe3 x\xf3a ticket xong.`)},e=>{this.msgObj.err++,console.warn(e),i.unsubscribe()}),n=Object(oe.a)(100).subscribe(()=>{i.closed&&(this.shared.alert.remove(t.messageId),n.unsubscribe())})}})):this.shared.alert.info("Vui l\xf2ng ch\u1ecdn d\xf2ng c\u1ea7n x\xf3a.")}onAutoFixTicket(){let e=this.gridApi.getSelectedNodes();0!==e.length?(this.visibleColumn("send_status",!0),this.isShowMsg=!0,this.msgObj={title:"S\u1eeda d\u1eef li\u1ec7u",total:e.length,ok:0,err:0},this.shared.modal.create({nzClosable:!1,nzOkText:"S\u1eeda d\u1eef li\u1ec7u",nzCancelText:"Kh\xf4ng",nzTitle:"C\u1ea3nh b\xe1o !!",nzContent:"B\u1ea1n c\xf3 ch\u1eafc mu\u1ed1n s\u1eeda d\xf2ng \u0111\u01b0\u1ee3c ch\u1ecdn ?",nzOnOk:()=>{let t=this.shared.loading("\u0110ang s\u1eeda d\u1eef li\u1ec7u"),i=e.map(e=>Object(ne.a)(e.data).pipe(Object(ie.a)(t=>this.refreshRow(e,{send_status:!0})),Object(b.a)(t=>this._handleAutoFixTicket(e)))),n=Object(ne.a)(...i).pipe(Object(Z.a)(e=>e.pipe(Object(ee.a)(5e3)))).subscribe(e=>{this.refreshRow(e.node,Object.assign(Object.assign({},e.data),{send_status:e.status})),"error"===e.status?this.msgObj.err++:this.msgObj.ok++},e=>{this.msgObj.err++,this.refreshRow(e.node,{send_status:"error"})}),o=Object(oe.a)(100).subscribe(()=>{n.closed&&(o.unsubscribe(),this.shared.alert.remove(t.messageId),this.visibleColumn("send_status",!1),this.clickAsyncTicket())})}})):this.shared.alert.info("B\u1ea1n ch\u01b0a ch\u1ecdn d\xf2ng \u0111\u1ec3 s\u1eeda.")}_handleAutoFixTicket(e){return new se.a(t=>{this.nodeTicket=e,this.ticketForm.setTicket(e.data,!0),this.ticketForm.autoFixTicket(null,!0),this.ticketForm.onSaveTicket(!1),t.next({data:{},node:e,status:"success"}),t.complete()})}clickConfigAccount(){this.router.navigate(["/account"])}clickQuestions(){this.router.navigate(["/questions"])}onRowClicked(e){this.nodeTicket=e.node,!0===this.asyncInput?this.shared.modal.confirm({nzTitle:"Th\xf4ng b\xe1o",nzContent:"B\u1ea1n \u0111ang nh\u1eadp li\u1ec7u th\xf4ng tin ticket. B\u1ea1n c\xf3 mu\u1ed1n c\u1eadp nh\u1eadt l\u1ea1i th\xf4ng tin t\u1eeb danh s\xe1ch v\u1eeba click.",nzCancelText:"Kh\xf4ng",nzOnCancel:()=>console.log("Kh\xf4ng c\u1eadp nh\u1eadt th\xf4ng tin v\u1eeda click t\u1eeb danh s\xe1ch"),nzOkText:"C\u1eadp nh\u1eadt",nzOnOk:()=>this.clickEditTicket(e.data)}):this.clickEditTicket(e.data)}clickEditTicket(e){Y.f.log("clickEditTicket()",e),this.editTicket=null,this.isLoadWithChanel||((e.chanels||[]).sort((e,t)=>e.position-t.position),this.editTicket=e,this.isNew=!1)}onRemoveTicket(e){console.log(`[${e.id}] X\xf3a Ticket`),this.onRemoveNode(this.nodeTicket)}onRemoveNode(e){this.gridApi.applyTransaction({remove:[e.data]})}clickLogout(){this.cfigCtrl.read().clear(this.shared),this.shared.navigateLogin(this.router)}clickRemoveCache(e=!0){Y.f.log("-- Xo\xe1 Cache --");let t=e?this.shared.loading("\u0110ang x\xf3a b\u1ed9 nh\u1edb"):void 0;this.cfigCtrl.clearAllCache().subscribe(e=>{void 0!==t&&(this.shared.alert.remove(t.messageId),this.shared.alert.success(e.msg,{nzDuration:2e3}))},e=>{console.warn(e)})}sortGridByIndex(e){Object(Y.i)(this.gridApi)||(this.gridColumnApi.applyColumnState({state:[{colId:"index_stt",sort:e}]}),this.lblGrid.view="STT > "+("asc"===e?"A-Z":"Z-A"))}showColumnAgGrid(e){let t=e;switch("object"==typeof e&&(t=e.grid_code),this.shared.setByKey("agGridViewType",t),this.agGridViewType=t,this.isViewSendHelpdesk=!1,this.disableWithChanel(this.isViewToolSendTicket),t){case"ALL":this.gridColumnApi.setColumnsVisible(this.agColumnFix.id,!0);break;case"DEFAULT":this.gridColumnApi.resetColumnState();break;case"REPORT_KPI":this.sortGridByIndex("asc"),this.searchForm.controls.withChanel.setValue(!0);break;case"BODY_EMAIL":!0===this.isLoadWithChanel&&this.searchForm.get("withChanel").setValue(!1),this.visibleColumns(["content_copy"],!0);break;case Gt.e:this.isViewSendHelpdesk=!0,this.msgObj=void 0,this.searchForm.get("withChanel").setValue(!1),this.searchForm.get("hideFormCreate").setValue(!0)}"object"==typeof e&&Ce.a.showOnlyColumns(this.gridColumnApi,this.agColumnFix.id,e)}resetDataAgrid(){this.data=[],this.dataCache=[],this.isShowMsg=!1,this.showBtnUpdate=!1,this.lblGrid.countTicket=0,this.lblGrid.countChanel=0}clickAsyncTicket(e){if(this.searchForm.invalid)return;this.resetDataAgrid(),this.editTicket=void 0,this.nodeTicket=void 0,this.lblPathDir_=void 0,this.isLoadSearch=!0,this.allImageUpload={},Object(Y.i)(e)||this.searchForm.get("withChanel").setValue(e);let t=this.searchForm.value;this.isLoadWithChanel=!0===t.withChanel;const i=new s.d("en-US").transform(t.ticketOn[0],"yyyy-MM-dd")+"T00:00:00",n=new s.d("en-US").transform(t.ticketOn[1],"yyyy-MM-dd")+"T23:59:59";let o=this.shared.loading(`\u0110ang L\u1ea5y d\u1eef li\u1ec7u <br/>- T\u1eeb ng\xe0y: <b>${i}</b> <br/> - \u0110\u1ebfn ng\xe0y: <b>${n}</b>`);this.ticketCtrl.findByCreateOn(i,n).subscribe(e=>{let t=e.content||[];this.lblGrid.countTicket=t.length,this.dataCache=t,this.isLoadWithChanel?(this.convertTicketByCheckViewChanel(t),this.lblGrid.countChanel=this.data.length,this.sortGridByIndex("asc")):(this.data=t,this.sortGridByIndex("asc")),this.isLoadSearch=!1,this.shared.alert.remove(o.messageId),this.shared.alert.success(`[${this.data.length}] L\u1ea5y Ticket xong r\u1ed3i.`),this.cd.detectChanges()},e=>{this.isLoadSearch=!1,this.shared.alert.remove(o.messageId),Y.f.log("X\u1ea3y ra l\u1ed7i l\u1ea5y d\u1eef li\u1ec7u:",e)})}clickRefreshConfig(){}showTicketWithChanel(e){Object(Y.i)(e)&&(e=this.searchForm.get("withChanel").value),this.isLoadWithChanel=!0===e,!0!==e?this.data=this.dataCache:this.convertTicketByCheckViewChanel()}get AgridHeader(){return this.gridColumnApi.getAllDisplayedColumns().map(e=>({[e.getColId()]:e.getColDef().headerName}))}convertTicketByCheckViewChanel(e=this.dataCache){console.log("convertTicketByCheckViewChanel()"),this.data=[];for(const t in e){const i=e[t];for(let e=0;e<i.chanels.length;e++){const t=Object.assign({},i);t.first_chanel=t.chanels[e],this.data.push(t)}}}visibleColumn(e,t=!0){this.gridColumnApi.setColumnVisible(e,t)}visibleColumns(e,t=!0,i=!0){Ce.a.visibleColumns(this.gridColumnApi,this.agColumnFix.id,e,t,i)}getAllRowSend(){if(this.isLoadWithChanel)return this.shared.modal.warning({nzContent:"Vui l\xf2ng b\u1ecf check `K\xeanh`"}),[];let e=this.gridApi.getSelectedNodes();return 0===e.length?(this.shared.modal.warning({nzContent:"Vui l\xf2ng ch\u1ecdn ticket \u0111\u1ec3 g\u1eedi"}),[]):(this.visibleColumn("send_status",!0),e)}refreshRow(e,t={}){Ce.a.refreshRow(this.gridApi,e,t)}onSendHelpdesk(e="all"){this.showColumnAgGrid(Gt.e);let t=this.getAllRowSend();if(0==t.length)return;let i=["all","add_note_with_img"].includes(e);if(i&&this.isViewUploadDir&&Object(Y.h)(this.allImageUpload))return void this.shared.modal.warning({nzTitle:"C\u1ea3nh b\xe1o !!",nzContent:"Vui l\xf2ng ch\u1ecdn th\u01b0 m\u1ee5c ch\u1ee9a h\xecnh \u0111\xednh k\xe8m."});this.isShowMsg=!0,this.isSendTicket=!0,this.msgObj={title:"G\u1eedi Ticket",total:t.length,ok:0,err:0,action:e},i=i&&!Object(Y.h)(this.allImageUpload);let n=t.map(t=>Object(ne.a)(t.data.ticket_id).pipe(Object(ie.a)(e=>this.refreshRow(t,{send_status:!0})),Object(b.a)(n=>this.handleSendTicket(t,e,i)))),o=Object(ne.a)(...n).pipe(Object(Z.a)(e=>e.pipe(Object(ee.a)(1e3))));this.runSendTicket=o.subscribe(e=>{this.refreshRow(e.node,Object.assign(Object.assign({},e.data),{send_status:e.status})),"error"===e.status?(this.msgObj.err++,this.showErrorAndStop(this.runSendTicket,e.node.data.ticket_id,e.data.error)):this.msgObj.ok++},e=>{this.msgObj.err++,this.refreshRow(e.node,{send_status:"error"}),this.showErrorAndStop(this.runSendTicket,e.node.data.ticket_id,e.error)});let s=Object(oe.a)(500).subscribe(e=>{!Object(Y.i)(this.runSendTicket)&&this.runSendTicket.closed&&(this.isSendTicket=!1,s.unsubscribe())},Object(te.a)(1))}handleSendTicket(e,t,i){t=Object(Y.l)(t)||"all"===t?null:t;let n=Object.assign({},e.data),o={isUpdate:this.isUpdateIfTicketExist,stopError:this.isStopTicketIfError,image_base64:!1===i?void 0:Object.keys(n.od_image).map(e=>e+".png").filter(e=>void 0!==this.allImageUpload[e]).map(e=>({[e]:this.allImageUpload[e]})).reduce((e,t)=>Object.assign(Object.assign({},e),t),{})};return null!==t&&-1===t.indexOf("close")||(n.stage={id:3,name:"Ho\xe0n th\xe0nh"}),this.helpdesk.allInOne(t,n.ticket_id,o).pipe(Object(b.a)(t=>Object(ne.a)({status:"success",node:e,data:t})),Object(Nt.a)(t=>Object(ne.a)({status:"error",node:e,data:{error:t}})))}stopSendTicket(){if(!Object(Y.i)(this.runSendTicket)){this.runSendTicket.unsubscribe(),this.shared.alert.warning("\u0110\xe3 d\u1eebng g\u1eedi !!");let e=Object(oe.a)(1e3).subscribe(t=>{this.clickAsyncTicket(),e.unsubscribe()},Object(te.a)(1))}}showErrorAndStop(e,t,i){"SessionExpired"===i.code?(e.unsubscribe(),this.shared.modal.error({nzTitle:"C\u1ea3nh b\xe1o !!",nzContent:i.message})):(this.shared.alert.error(`[${t}] > ${i.message}`),this.isStopTicketIfError&&e.unsubscribe())}onExportExcelMau(){this.excelCtrl.downloadFile("/assets/reportkpi_mau.xlsx").subscribe()}onExportXlsx(){Ce.a.exportExcel(this.gridApi,this.gridColumnApi,{fileName:"report_kpi"})}onImportXlsx(){return Object(d.a)(this,void 0,void 0,(function*(){this.isRunImport=!0,this.msgObj={title:"N\u1ea1p Excel",ok:0,err:0,total:0},this.shared.modal.create({nzTitle:"N\u1ea1p d\u1eef li\u1ec7u t\u1eeb file excel",nzContent:Mt.a,nzClassName:"select-file",nzClosable:!1,nzMaskClosable:!0,nzFooter:null,nzComponentParams:{isImportAndSave:!0}}).afterClose.pipe(Object(ie.a)(e=>{if(Object(Y.i)(e))return void(this.isRunImport=!1);e=Object.assign({isSave:!1,items:[]},e),this.data=[],this.dataCache=[],this.msgObj.total=e.items.length,this.msgObj.action=!0===e.isSave?"L\u01b0u":"Th\xeam";let t=e.isSave||!1,i=e.items.map(e=>this.prepareTicketFromXlsx(e)),n=Object(ne.a)(...i).pipe(Object(Z.a)(e=>Object(ne.a)(e).pipe(Object(ee.a)(2e3)))).subscribe(e=>{console.log(e),this.msgObj.ok++,t?(this.ticketForm.isAutoCreate=!0,this.ticketForm.setTicket(e,!0),this.ticketForm.onSaveTicket(),this.onSaveTicket({isNew:!0,ticket:this.ticketForm.editTicket})):this.onSaveTicket({isNew:!0,ticket:e})},e=>{this.msgObj.err++,console.warn(e)}),o=Object(oe.a)(1e3).subscribe(e=>{n.closed&&(this.isRunImport=!1,o.unsubscribe())})})).subscribe()}))}prepareTicketFromXlsx(e){let t=Object.assign({},e);if(["software","group_help","support_help","product_id","chanels"].forEach(e=>delete t[e]),!Object(Y.l)(e.chanels)){let i=e.chanels.split(",").map(e=>e.trim()),n=this.ticketForm.chanels.filter(e=>i.includes(e.extend_code));n.length>0&&(t.chanels=n)}if(!Object(Y.l)(e.software)){let i=e.software.trim(),n=this.ticketForm.softwares.filter(e=>e.code===i);n.length>0&&(t.software=n[0])}if(!Object(Y.l)(e.group_help)){let i=e.group_help.trim(),n=this.ticketForm.ghelps.filter(e=>e.code===i);n.length>0&&(t.group_help=n[0])}if(!Object(Y.l)(e.support_help)){let i=e.support_help.trim(),n=this.ticketForm.chanels.filter(e=>e.extend_code===i);n.length>0&&(t.support_help=n[0])}if(!Object(Y.l)(e.product_id)){let i=e.product_id.trim(),n=this.ticketForm.products.filter(e=>e.id===i);n.length>0&&(t.product=n[0])}return t}isShowTool(e){if("tool3"===e){let e=["delete_list","fix_row"];return this.totalSelect>0&&e.filter(e=>this.userDetail.isRole(e)).length>0}return"tool4"===e&&this.agGridViewType===Gt.e}showCustomColumnAgGrid(e){this.showColumnAgGrid(e),this.agGridCustom=e}createAgGridTemplate(){let e=Object.assign({grid_type:this.KEY_GRID_TYPE},!0===this.agGridCustom.is_system?void 0:this.agGridCustom,{columns:this.gridColumnApi.getAllDisplayedColumns()});this.shared.modal.create({nzTitle:"T\u1ea1o / C\u1eadp nh\u1eadt m\u1eabu",nzFooter:null,nzClosable:!1,nzWidth:"360px",nzContent:Et,nzComponentParams:{data:e,count:this.allGridField.length}})}handleUpload(){console.log(this.allImageUpload)}onSendReport(){this.router.navigateByUrl("/send-report")}}return e.\u0275fac=function(t){return new(t||e)(a.Nb(Rt.a),a.Nb(a.h),a.Nb(o.e),a.Nb(q.a),a.Nb(H.a),a.Nb(n.d),a.Nb(n.a),a.Nb(P.a),a.Nb(K.a),a.Nb(G.a),a.Nb(Ut))},e.\u0275cmp=a.Hb({type:e,selectors:[["t2t-table"]],viewQuery:function(e,t){var i;1&e&&(a.Hc(qt,!0),a.Hc(Ht,!0),a.Hc(Pt,!0),a.Hc(Yt,!0)),2&e&&(a.qc(i=a.bc())&&(t.agrid=i.first),a.qc(i=a.bc())&&(t.ticketForm=i.first),a.qc(i=a.bc())&&(t.importComp=i.first),a.qc(i=a.bc())&&(t.linkDown=i.first))},features:[a.xb],decls:65,vars:35,consts:[[3,"ticket","isAutoLoadCate","asyncInput","save","remove"],["ticketForm",""],[1,"ag-ticket"],[1,"row","tool-2"],[1,"col-12"],["nz-form","",1,"search-form",3,"nzLayout","formGroup"],[2,"margin-left","2px","width","300px"],["formControlName","ticketOn",3,"nzFormat"],["nz-checkbox","","formControlName","withChanel"],["nz-checkbox","","formControlName","hideFormCreate"],["type","button","nz-button","","nzType","dash",3,"disabled","click"],["nz-icon","",3,"nzType","nzSpin",4,"ngIf"],["nz-icon","","nzType","search","theme","outline",4,"ngIf"],[4,"ngIf"],["nz-button","","nz-dropdown","",3,"nzTrigger","nzDropdownMenu","disabled"],["nz-icon","","nzType","appstore","nzTheme","outline"],["nzMenuOther",""],["nz-menu",""],["nz-menu-item","",3,"click",4,"ngIf"],["nz-icon","","nzType","export","theme","outline"],["nzMenuAccount",""],["nz-menu-item","",3,"click"],["nz-icon","","nzType","delete"],["nz-icon","","nzType","question-circle"],["nz-menu-item","",3,"routerLink",4,"ngIf"],["nz-icon","","nzType","logout"],[1,"countRow"],[1,"lbl"],[1,"number"],[2,"width","100%","height","100%"],["minHeight","300px",3,"options","modules","columns","rows","gridReady"],["nz-icon","",3,"nzType","nzSpin"],["nz-icon","","nzType","search","theme","outline"],["nz-icon","","nzType","down"],["nzMenuFilter",""],["ngFor","",3,"ngForOf","ngForTrackBy"],["nz-icon","","nzType","cloud","theme","outline",4,"ngIf"],["nzMenuSendHelpdesk",""],["nz-icon","","nzType","cloud","theme","outline"],["nz-button","","nz-dropdown","","nzTrigger","click",3,"nzDropdownMenu","disabled"],["nz-icon","","nzType","solution",4,"ngIf"],["nzMenuNXDL",""],["nz-icon","","nzType","download"],["nz-icon","","nzType","file-excel"],["nz-icon","","nzType","solution"],["nz-icon","","nzType","upload"],["nz-button","","nz-dropdown","",3,"nzDropdownMenu","nzTrigger","disabled"],["nz-icon","","nzType","bars"],["nzMenuReport",""],["nz-menu","",1,"ag_grid"],["nz-icon","","nzType","retweet"],["nz-icon","","nzType","file-add","nzTheme","outline"],["nz-menu-item","",3,"routerLink"],["nz-icon","","nzType","setting"],[1,"row","tool-3","mb-2","mt-2"],[1,"col-12","d-flex"],["nzType","vertical",1,"align-self-center"],["nz-checkbox","",3,"ngModel","ngModelChange"],["nzAccept","image/png","nzMultiple","",3,"nzBeforeUpload"],[1,"link_dir"],[1,"send-log","d-flex","align-items-center"],[1,"oki"],[1,"err"],[1,"total"],[1,"act"],[1,"run"],[1,"btnStopSend",3,"click"]],template:function(e,t){if(1&e&&(a.Tb(0,"t2t-ticket-form",0,1),a.ac("asyncInput",(function(e){return t.asyncInput=e}))("save",(function(e){return t.onSaveTicket(e)}))("remove",(function(e){return t.onRemoveTicket(e)})),a.Sb(),a.Tb(2,"div",2),a.Tb(3,"div",3),a.Tb(4,"div",4),a.Tb(5,"form",5),a.Tb(6,"nz-form-item"),a.Tb(7,"nz-form-control",6),a.Ob(8,"nz-range-picker",7),a.Sb(),a.Sb(),a.Tb(9,"nz-form-item"),a.Tb(10,"nz-form-control"),a.Tb(11,"label",8),a.Dc(12,"K\xeanh"),a.Sb(),a.Tb(13,"label",9),a.Dc(14,"\u1ea8n Form"),a.Sb(),a.Sb(),a.Sb(),a.Tb(15,"nz-form-item"),a.Tb(16,"nz-form-control"),a.Tb(17,"button",10),a.ac("click",(function(){return t.clickAsyncTicket()})),a.Bc(18,Wt,1,2,"i",11),a.Bc(19,$t,1,0,"i",12),a.Dc(20,"L\u1ea5y d\u1eef li\u1ec7u "),a.Sb(),a.Sb(),a.Sb(),a.Bc(21,Qt,9,5,"nz-form-item",13),a.Tb(22,"nz-form-item"),a.Tb(23,"nz-form-control"),a.Bc(24,ei,24,5,"ng-container",13),a.Bc(25,oi,18,5,"ng-container",13),a.Bc(26,ci,14,6,"ng-container",13),a.Tb(27,"button",14),a.Ob(28,"i",15),a.Dc(29,"Kh\xe1c "),a.Sb(),a.Tb(30,"nz-dropdown-menu",null,16),a.Tb(32,"ul",17),a.Bc(33,ri,3,0,"li",18),a.Bc(34,ai,3,0,"li",18),a.Bc(35,li,3,0,"li",18),a.Bc(36,di,3,0,"li",18),a.Sb(),a.Sb(),a.Tb(37,"button",14),a.Ob(38,"i",19),a.Dc(39,"T\xe0i kho\u1ea3n "),a.Sb(),a.Tb(40,"nz-dropdown-menu",null,20),a.Tb(42,"ul",17),a.Tb(43,"li",21),a.ac("click",(function(){return t.clickRemoveCache()})),a.Tb(44,"a"),a.Ob(45,"i",22),a.Dc(46,"X\xf3a Cache"),a.Sb(),a.Sb(),a.Tb(47,"li",21),a.ac("click",(function(){return t.clickQuestions()})),a.Tb(48,"a"),a.Ob(49,"i",23),a.Dc(50,"C\xe2u h\u1ecfi"),a.Sb(),a.Sb(),a.Bc(51,hi,4,2,"li",24),a.Tb(52,"li",21),a.ac("click",(function(){return t.clickLogout()})),a.Tb(53,"a"),a.Ob(54,"i",25),a.Dc(55,"\u0110\u0103ng xu\u1ea5t"),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Tb(56,"label",26),a.Tb(57,"span",27),a.Dc(58,"T\u1ed5ng s\u1ed1: "),a.Sb(),a.Tb(59,"span",28),a.Dc(60),a.Sb(),a.Bc(61,ui,5,1,"span",13),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Bc(62,Ti,12,5,"ng-container",13),a.Tb(63,"div",29),a.Tb(64,"cy-ag-table",30),a.ac("gridReady",(function(e){return t.onGridReady(e)})),a.Sb(),a.Sb(),a.Sb()),2&e){const e=a.rc(31),i=a.rc(41);a.yc("display",t.isHideFormCreate),a.jc("ticket",t.editTicket)("isAutoLoadCate",t.isAutoLoadCate),a.zb(5),a.jc("nzLayout","inline")("formGroup",t.searchForm),a.zb(3),a.jc("nzFormat","yyyy-MM-dd"),a.zb(9),a.jc("disabled",t.disabledAction),a.zb(1),a.jc("ngIf",t.isLoadSearch),a.zb(1),a.jc("ngIf",!t.isLoadSearch),a.zb(2),a.jc("ngIf",t.userDetail.isRole(a.lc(32,ki))),a.zb(3),a.jc("ngIf",t.isShowTool("tool4")),a.zb(1),a.jc("ngIf",t.userDetail.isRole(a.lc(33,_i))),a.zb(1),a.jc("ngIf",t.userDetail.isRole(a.lc(34,Si))),a.zb(1),a.jc("nzTrigger","click")("nzDropdownMenu",e)("disabled",t.disabledAction),a.zb(6),a.jc("ngIf",t.isRole("delete_list")),a.zb(1),a.jc("ngIf",t.isRole("fix_row")),a.zb(1),a.jc("ngIf",t.isRole("create_grid")),a.zb(1),a.jc("ngIf",t.isRole("send_report")),a.zb(1),a.jc("nzTrigger","click")("nzDropdownMenu",i)("disabled",t.disabledAction),a.zb(14),a.jc("ngIf",t.isRole("admin")),a.zb(9),a.Fc("T=",t.countTicket," "),a.zb(1),a.jc("ngIf",t.isLoadWithChanel),a.zb(1),a.jc("ngIf",t.isViewToolSendTicket),a.zb(2),a.jc("options",t.gridOptions)("modules",t.agAllModule)("columns",t.columnDefs)("rows",t.data)}},directives:[Vt,o.t,o.m,w.b,o.h,Kt.c,w.c,Kt.a,w.a,F.a,F.c,o.l,o.g,D.a,v.a,je.a,T.a,s.n,A.c,A.a,O.a,A.d,j.c,j.d,re.a,s.m,n.e,x.a,o.o,I.a,y.c],styles:[".ag-ticket{box-sizing:border-box;margin-bottom:40px;border-top:2px solid #2f54eb;padding-top:.5rem}.ag-ticket .fal{font-size:1rem;font-weight:inherit}.ag-ticket .fal.fa-exclamation-circle{color:var(--red)}.ag-ticket .fal.fa-times{color:var(--danger)}.ag-ticket .fal.fa-comment{color:var(--info)}ul.ag_grid .menu-header{padding:unset}ul.ag_grid .menu-header .title{padding:5px 12px}.send-log{width:unset}.send-log label{margin-right:5px}.send-log label i{margin-left:5px}.send-log label .err{color:var(--red)}.send-log label .oki{color:var(--success)}.send-log label .total{color:var(--indigo)}.send-log label .run{color:var(--info)}.send-log label .act{color:var(--primary)}a.link_dir{color:var(--red)!important}.ant-divider{top:-.3em}.search-form [nz-checkbox],.search-form nz-range-picker{margin-right:5px}.search-form.ant-form-inline .ant-form-item{margin-right:0}.search-form label.countRow .lbl{color:#007bff}.search-form label.countRow .number{color:red}.row.tool-3 .ant-form-item{margin:9px 0 15px}.row.tool-3 .ant-form-item-control{line-height:0}.row.tool-3 .col-send-result{font-weight:700}.row.tool-3 .col-send-result .ok{margin-left:5px;color:#007bff}.row.tool-3 .col-send-result .err{margin-left:5px;color:#dc3545}.row.tool-3 .col-send-result .total{margin-left:5px;color:#28a745}.row.tool-3 .btnStopSend{color:#0056b3;text-decoration:underline}[nz-menu]{min-width:200px}[nz-menu] .ant-divider-inner-text{padding:0 10px}.select-file .ant-modal-body{padding:0}"],encapsulation:2}),e})(),Ci=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.b,o.i,o.q,N.a,y.e,v.c,O.b],N.a]}),e})(),ji=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},imports:[[s.b,o.i,o.q,N.a,v.c,O.b,I.b]]}),e})();const zi=[{path:"",component:Oi}];let yi=(()=>{class e{}return e.\u0275mod=a.Lb({type:e}),e.\u0275inj=a.Kb({factory:function(t){return new(t||e)},providers:[],imports:[[s.b,n.g.forChild(zi),c.d,o.i,o.q,E,F.b,M,Ci,V.a,ji,r.c,j.e,z,y.e,D.c,A.b,C,x.b,v.c,O.b,w.d,I.b]]}),e})()}}]);